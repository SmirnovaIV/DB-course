<?php
 if (!defined('_C_ERRORS')) {define('_C_ERRORS', true);}error_reporting(DEBUG ? (defined('E_DEPRECATED') ? ~E_STRICT & ~E_DEPRECATED : ~E_STRICT) : E_ERROR);ini_set("display_errors", "1");class umiExceptionHandler {private static $templateFile = NULL;protected static function getExceptionTemplate() {if ( !self::$templateFile ) {self::setExceptionTemplate(SYS_ERRORS_PATH . "exception.html.php")    || self::setExceptionTemplate(SYS_ERRORS_PATH . "exception.php");}return self::$templateFile;}protected static function setExceptionTemplate($v8c7dd922ad47494fc02c388e12c00eac) {if (!file_exists($v8c7dd922ad47494fc02c388e12c00eac) ) {self::$templateFile = NULL;return false;}else {self::$templateFile = $v8c7dd922ad47494fc02c388e12c00eac;}}protected static function printTemplate($ve1671797c52e15f763380b45e841ec32) {$v42552b1f133f9f8eb406d4f306ea9fd1 = new StdClass;$v42552b1f133f9f8eb406d4f306ea9fd1->code  = $ve1671797c52e15f763380b45e841ec32->getCode();$v42552b1f133f9f8eb406d4f306ea9fd1->message = $ve1671797c52e15f763380b45e841ec32->getMessage();$v42552b1f133f9f8eb406d4f306ea9fd1->type  = get_class($ve1671797c52e15f763380b45e841ec32);if (DEBUG_SHOW_BACKTRACE) {$v42552b1f133f9f8eb406d4f306ea9fd1->trace = $ve1671797c52e15f763380b45e841ec32->getTrace();$v42552b1f133f9f8eb406d4f306ea9fd1->traceAsString = $ve1671797c52e15f763380b45e841ec32->getTraceAsString();}require self::getExceptionTemplate();}public static function set($vab8c9e32f5757d87122d20d002fc1749='base', $v66f6181bcb4cff4cd38fbc804a036db6 = "") {$vab8c9e32f5757d87122d20d002fc1749 = $vab8c9e32f5757d87122d20d002fc1749."Handler";if ( method_exists(__CLASS__, $vab8c9e32f5757d87122d20d002fc1749) ) {self::setExceptionTemplate($v66f6181bcb4cff4cd38fbc804a036db6);return set_exception_handler(array(       __CLASS__,       $vab8c9e32f5757d87122d20d002fc1749      ));}else {throw new Exception("Error handler not exist");}}public static function restore() {return restore_exception_handler();}public static function createCrashReport($v78e731027d8fd50ed642340b7c9a63b3, $v04a75036e9d520bb983c5ed03b8d0182) {$v63a04a2f17915ed7c241c38ff2a29f4d = CURRENT_WORKING_DIR . "/errors/logs/exceptions/";if(!is_dir($v63a04a2f17915ed7c241c38ff2a29f4d)) {mkdir($v63a04a2f17915ed7c241c38ff2a29f4d, 0777, true);}try {$v6db435f352d7ea4a67807a3feb447bf7 = new umiLogger($v63a04a2f17915ed7c241c38ff2a29f4d);$v6db435f352d7ea4a67807a3feb447bf7->pushGlobalEnviroment();$v6db435f352d7ea4a67807a3feb447bf7->push($v78e731027d8fd50ed642340b7c9a63b3);$v6db435f352d7ea4a67807a3feb447bf7->push($v04a75036e9d520bb983c5ed03b8d0182);$v6db435f352d7ea4a67807a3feb447bf7->save();return true;}catch (Exception $ve1671797c52e15f763380b45e841ec32) {echo "Can't log exception";return false;}}public static function baseHandler($ve1671797c52e15f763380b45e841ec32) {if (!defined('CURRENT_WORKING_DIR')) {define(     'CURRENT_WORKING_DIR',     dirname(dirname(__FILE__))    );}require_once CURRENT_WORKING_DIR . "/classes/system/utils/logger/iLogger.php";require_once CURRENT_WORKING_DIR . "/classes/system/utils/logger/logger.php";if (!DEBUG_SHOW_BACKTRACE && $ve1671797c52e15f763380b45e841ec32 instanceof Exception && get_class($ve1671797c52e15f763380b45e841ec32) == 'databaseException') {$ve1671797c52e15f763380b45e841ec32 = new Exception('Произошла критическая ошибка. Скорее всего, потребуется участие разработчиков.  Подробности по ссылке <a title="" target="_blank" href="http://errors.umi-cms.ru/17000/">17000</a>', 17000, $ve1671797c52e15f763380b45e841ec32);}if (!headers_sent()) {header("HTTP/1.1 500 Internal Server Error");header("Content-type: text/html; charset=utf-8");header("Status: 500 Internal Server Error");}self::printTemplate($ve1671797c52e15f763380b45e841ec32);self::createCrashReport($ve1671797c52e15f763380b45e841ec32->getMessage(), $ve1671797c52e15f763380b45e841ec32->getTraceAsString());exit();}public static function outputBufferHandler($v7f2db423a49b305459147332fb01cf87) {if( isset($v406baa482a63f95c711e0d4ef080b1da['memoryReserve']) ) {unset($v406baa482a63f95c711e0d4ef080b1da['memoryReserve']);}$v07213a0161f52846ab198be103b5ab43 = Array('Fatal', 'Parse');foreach($v07213a0161f52846ab198be103b5ab43 as $vcb5e100e5a9a3e7f6d1fd97512215282) {if(strstr($v7f2db423a49b305459147332fb01cf87, "<br />\n<b>{$vcb5e100e5a9a3e7f6d1fd97512215282} error</b>:") !== false) {throw new coreException(      substr(       trim(strip_tags($v7f2db423a49b305459147332fb01cf87)),       strlen($vcb5e100e5a9a3e7f6d1fd97512215282) + 9      )     );}}return $v7f2db423a49b305459147332fb01cf87;}}if (!defined('CRON')) {if (getRequest("xmlMode") == 'force') {$v66f6181bcb4cff4cd38fbc804a036db6 = SYS_ERRORS_PATH."exception.xml.php";}elseif (getRequest("jsonMode") == 'force') {$v66f6181bcb4cff4cd38fbc804a036db6 = SYS_ERRORS_PATH."exception.json.php";}else {$v66f6181bcb4cff4cd38fbc804a036db6 = SYS_ERRORS_PATH."exception.html.php";}umiExceptionHandler::set("base", $v66f6181bcb4cff4cd38fbc804a036db6);}$v406baa482a63f95c711e0d4ef080b1da['memoryReserve'] = str_repeat(" ", 1024);if(!defined("DEBUG") && function_exists("libxml_use_internal_errors")) {libxml_use_internal_errors(true);}function checkXmlError($vdd988cfd769c9f7fbd795a0f5da8e751) {if ( !defined("DEBUG") && function_exists("libxml_get_last_error") && $vdd988cfd769c9f7fbd795a0f5da8e751 === false ) {$vcb5e100e5a9a3e7f6d1fd97512215282 = libxml_get_last_error();libxml_clear_errors();throw new libXMLErrorException($vcb5e100e5a9a3e7f6d1fd97512215282);}}function criticalErrorsBufferHandler($v7f2db423a49b305459147332fb01cf87) {return umiExceptionHandler::outputBufferHandler($v7f2db423a49b305459147332fb01cf87);}function xsltErrorsHandler($v70106d0d821513f45702b7d25664ab7c, $v809b1abe3f111fd3bb1a54c62706129f, $v1407f5af8e27ad3df1c3300918c80813, $vc2d4b0be0178288d69e1fbfd34098cc3, $ve1671797c52e15f763380b45e841ec32) {if( defined("DEBUG") ||   !function_exists("libxml_get_last_error") ||   $vc2d4b0be0178288d69e1fbfd34098cc3 != 0 ||   $v70106d0d821513f45702b7d25664ab7c != 2  ) return;throw new xlsTemplateException(libxml_get_errors());}function errorsXsltListen() {if ( !defined("DEBUG") ) {set_error_handler("xsltErrorsHandler");return error_reporting(~E_STRICT);}return false;}function errorsXsltCheck($v818f9c45cfa30eeff277ef38bcbe9910) {if(!defined("DEBUG")) {error_reporting($v818f9c45cfa30eeff277ef38bcbe9910);return restore_error_handler();}return false;}function traceException($ve1671797c52e15f763380b45e841ec32) {umiExceptionHandler::baseHandler($ve1671797c52e15f763380b45e841ec32);}?>
