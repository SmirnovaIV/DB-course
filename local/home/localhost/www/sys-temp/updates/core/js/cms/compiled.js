var uAdmin=(function(){var register=function(){var checkClass=function(parent,parent_str){for(var i in parent.reg){if(parent.reg[parent_str]){return parent.reg[parent_str]}else{return checkClass(parent.reg[i],parent_str)}}return false};var name,value,parent,params=arguments[0];if(params.length){if(typeof params[0]=="object"){if(Object.prototype.toString.call(params[0])=="[object Array]"){return false}for(var i in params[0]){register([i,params[0][i],params[1]||null])}return true}else{if(typeof params[0]=="string"){if(typeof params[1]=="undefined"){return false}name=params[0];value=params[1];parent=params[2]||null}else{return false}}}else{return false}if(!parent){parent=uAdmin}if(typeof parent=="string"){parent=checkClass(uAdmin,parent)}if(typeof parent!="function"){return false}var isclass=false;name=name.split(".");if(name.length>1){isclass=true}name=name.pop();var reg=function(){parent.reg[name]=value;if(isclass){parent.reg[name].isclass=true}};if(!parent.reg){parent.reg=reg}reg();return true};function uAdmin(){if(uAdmin.prototype.instanse==null){uAdmin.prototype.instanse=new uAdmin.prototype.get()}register(arguments);return uAdmin.prototype.instanse}uAdmin.prototype.get=function(){return this};uAdmin.prototype.get.prototype=uAdmin.prototype;uAdmin.prototype.init=function(){uAdmin.load(uAdmin);delete uAdmin.reg;delete uAdmin.load;if(uAdmin.csrf){jQuery(document).ajaxSend(function(event,jqXhr,settings){if(!settings||!settings.type){return true}switch(settings.type){case"POST":if(typeof settings.data=="undefined"){settings.data=""}settings.data+=settings.data.length?"&csrf="+uAdmin.csrf:"csrf="+uAdmin.csrf;break;case"GET":settings.url+=~settings.url.indexOf("?")?"&csrf="+uAdmin.csrf:"?csrf="+uAdmin.csrf;break}})}var images=document.getElementsByTagName("img");for(var i=0;i<images.length;i++){if(images[i].getAttribute("umi:field-name")=="photo"){images[i].style.maxWidth=images[i].width+"px";images[i].style.maxHeight=images[i].height+"px"}}};if(typeof JSON=="undefined"){JSON={parse:function(str){try{if(str.match(/^{/g)){var val=eval("("+str+")");if(Object.prototype.toString.call(val)=="[object Object]"){return val}}throw new SyntaxError("JSON.parse: unexpected end of data")}catch(e){throw new SyntaxError("JSON.parse: unexpected end of data")}}}}if(!window.pageData){var data=jQuery.ajax({url:location.pathname+".json"+location.search,dataType:"json",async:false});uAdmin("data",JSON.parse(data.responseText))}else{uAdmin("data",window.pageData)}var onLoadEventHandlers={};uAdmin.onLoad=function(loadedItemName,eventHandler){if(typeof eventHandler!="function"){return false}if(loadedItemName in onLoadEventHandlers===false){onLoadEventHandlers[loadedItemName]=[]}onLoadEventHandlers[loadedItemName].push(eventHandler);return eventHandler in onLoadEventHandlers[loadedItemName]};uAdmin.load=function(parent){for(var i in parent.reg){if(parent.reg[i].reg){uAdmin.load(parent.reg[i])}if(parent.reg[i].isclass){var extend=function(usedClass,extendClass){for(var i in extendClass){usedClass.prototype[i]=extendClass[i]}return new usedClass()};if(parent==uAdmin){parent[i]=new parent.reg[i](extend)}else{parent.prototype[i]=new parent.reg[i](extend)}}else{if(parent==uAdmin){parent[i]=parent.reg[i]}else{parent.prototype[i]=parent.reg[i]}}var moduleOnLoadEventHandlers=onLoadEventHandlers[i];if(moduleOnLoadEventHandlers!=undefined&&moduleOnLoadEventHandlers.length>0){for(var j=0;j<moduleOnLoadEventHandlers.length;j++){if(typeof moduleOnLoadEventHandlers[j]=="function"){moduleOnLoadEventHandlers[j]()}}}}};return uAdmin})();jQuery(document).ready(function(){uAdmin().init()});uAdmin(".panel",function(b){function a(){var c=this;jQuery("html").addClass("u-eip");this.panelHolder=this.addPanelHolder();this.quickpanel=this.addQuickpanel();this.showHideBtn=this.addShowHideBtn();this.drawControls();jQuery(document).bind("click",function(f){if(!jQuery(f.target).parents("#u-quickpanel").size()){c.changeAct()}});if(!jQuery.cookie("eip-panel-state-first")){this.quickpanel.css({overflow:"hidden",height:"0"});this.showHideBtn.addClass("collapse");this.quickpanel.delay(500).animate({height:"25px"},500,function(){jQuery(this).css("overflow","visible");c.showHideBtn.removeClass("collapse")});this.quickpanel.fadeTo(300,0.3);this.quickpanel.fadeTo(300,1);jQuery.cookie("eip-panel-state","",{path:"/",expires:0});var e=new Date();e.setTime(e.getTime()+(30*24*60*60*1000));jQuery.cookie("eip-panel-state-first","Y",{path:"/",expires:e})}var d="/admin/content/frontendPanel/.json?links";d+="&ts="+Math.round(Math.random()*1000);jQuery.ajax({url:d,dataType:"json",success:this.onLoadData})}a.prototype.drawControls=function(){this.exitButton=this.addExitButton();this.helpButton=this.addHelpButton();this.butterfly=this.addButtrfly();this.eipHolder=this.addEipHolder();this.editMenu=this.addEditMenu();this.lastDoc=this.addLastDoc();this.changelogDd=this.addChangelogDd();this.note=this.addNote();this.metaHolder=this.addMetaHolder()};a.prototype.addPanelHolder=function(){return jQuery('<div id="u-panel-holder" />').appendTo("body")};a.prototype.addQuickpanel=function(){if(!this.panelHolder.length){return null}return jQuery('<div id="u-quickpanel" />').appendTo(this.panelHolder)};a.prototype.addShowHideBtn=function(){if(!this.panelHolder.length){return null}var c=this;return jQuery('<div id="u-show_hide_btn" />').appendTo(this.panelHolder).click(function(){c.swap(this)})};a.prototype.addExitButton=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="exit" title="'+getLabel("js-panel-exit")+'">&#160;</div>\n		').appendTo(this.quickpanel).click(function(){window.location="/users/logout/";return false})};a.prototype.addHelpButton=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="help" title="'+getLabel("js-panel-documentation")+'">&#160;</div>\n		').appendTo(this.quickpanel).click(function(){window.open("http://help.umi-cms.ru/admin_panel.htm");return false})};a.prototype.addButtrfly=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="butterfly">\n				<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-modules")+'\n				<div class="bg">\n					<ul id="u-mods-cont-left" />\n					<ul id="u-mods-cont-right" />\n					<div class="clear separate" />\n					<ul id="u-mods-utils" />\n					<ul id="u-mods-admin" />\n					<div class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel)};a.prototype.addEipHolder=function(){if(!this.quickpanel.length){return null}return jQuery("<div />").attr({id:"eip_holder"}).appendTo(this.quickpanel)};a.prototype.addMetaHolder=function(){if(!this.quickpanel.length){return null}return jQuery("<div />").attr({id:"meta_holder"}).appendTo(this.quickpanel)};a.prototype.addEditMenu=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="edit_menu" title="'+getLabel("js-panel-edit-menu")+'">\n				<span class="in_ico_bg">&#160;</span>\n				<div>\n					<ul id="u-docs-edit"/>\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel)};a.prototype.addLastDoc=function(){if(!this.quickpanel.length){return null}var c=this;return jQuery('\n			<div id="last_doc">\n				<span class="in_ico_bg" />\n				'+getLabel("js-panel-last-documents")+'\n				<div>\n					<ul id="u-docs-recent" />\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel).click(function(){c.changeAct(this)})};a.prototype.addChangelogDd=function(){if(!this.quickpanel.length){return null}var c=this;return jQuery('\n			<div id="changelog_dd" style="display:none;">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-history-changes")+'\n				<div>\n					<ul id="u-changelog" />\n					<span class="clear" />\n				</div>\n			</div>\n		').appendTo(this.quickpanel).click(function(){c.changeAct(this)})};a.prototype.addNote=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="note">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-note")+"\n			</div>\n		").appendTo(this.quickpanel)};a.prototype.addSeoButton=function(){if(!this.quickpanel.length){return null}return jQuery('\n			<div id="seo">				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("module-seo")+"\n			</div>\n		").appendTo(this.quickpanel).click(function(){window.location="/admin/seo/"})};a.prototype.onLoadData=function(e){var l=uAdmin.panel;if(!l){return false}jQuery('<link type="text/css" rel="stylesheet" href="/styles/skins/_eip/css/theme.css" />').appendTo("head");var g,c;for(g in e.documents.recent.page){g=e.documents.recent.page[g];jQuery("ul#u-docs-recent",l.lastDoc).append('<li><a href="'+g.link+'">'+g.name+"</a></li>")}var f=0;for(g in e.documents.editable.page){g=e.documents.editable.page[g];for(c in e.modules.module){c=e.modules.module[c];if(c.name==g.basetype.module){continue}}jQuery("ul#u-docs-edit",l.quickpanel||null).append('<li><a href="'+(uAdmin.lang_prefix?"/"+uAdmin.lang_prefix:"")+g["edit-link"]+'">'+g.name+"</a></li>");f++}if(f&&l.editMenu){l.editMenu.click(function(){l.changeAct(this)})}else{if(l.editMenu){l.editMenu.hide(0)}}f=0;for(c in e.modules.module){c=e.modules.module[c];var d;switch(c.type){case"system":d="ul#u-mods-utils";break;case"util":d="ul#u-mods-admin";break;default:d=(++f%2)?"ul#u-mods-cont-left":"ul#u-mods-cont-right"}jQuery(d,l.butterfly||null).append('<li><a href="'+(uAdmin.lang_prefix?"/"+uAdmin.lang_prefix:"")+"/admin/"+c.name+'/">'+c.label+"</a></li>")}if(f&&l.butterfly){l.butterfly.click(function(){l.changeAct(this)}).addClass("butterfly_hover")}if(typeof e.changelog!="undefined"&&l.changelogDd){for(var j in e.changelog.revision){j=e.changelog.revision[j];var k=j.date.std+(j.author.name?" - "+j.author.name:"")+(j.active=="active"?"&nbsp;&nbsp;&nbsp;&larr;":"");var h=j.link+"?force-redirect="+window.location.pathname;jQuery("#u-changelog",l.changelogDd).append('<li><a href="'+h+'">'+k+"</a></li>")}l.changelogDd.css("display","")}else{if(l.changelogDd){l.changelogDd.css("display","none")}}if(typeof e.tickets!="undefined"&&typeof uAdmin.tickets=="object"){uAdmin.tickets.draw(e)}else{if(l.note){l.note.remove()}}};a.prototype.swap=function(d){var c=jQuery("#u-quickpanel").css("height");if(c=="0px"){return this.expand(d)}else{if(uAdmin.eip.meta.enabled){jQuery("#u-quickpanel #meta").trigger("click")}return this.collapse(d)}};a.prototype.expand=function(d){var c=jQuery("#u-quickpanel");c.css("overflow","visible");c.animate({height:"25px"},700);jQuery(d).removeClass("collapse");jQuery.cookie("eip-panel-state","",{path:"/",expires:0})};a.prototype.collapse=function(e){var d=jQuery("#u-quickpanel");d.css("overflow","hidden");d.animate({height:"0"},700);jQuery(e).addClass("collapse");var c=new Date();c.setTime(c.getTime()+(30*24*60*60*1000));jQuery.cookie("eip-panel-state","collapsed",{path:"/",expires:c})};a.prototype.loadRes=function(c,e,f){var d;switch(c){case"js":case"text/javascript":d=document.createElement("script");d.src=e;d.charset="utf-8";break;case"css":case"text/css":d=document.createElement("link");d.href=e;d.rel="stylesheet";break;default:return}document.body.parentNode.firstChild.appendChild(d);if(typeof f=="function"){jQuery(document).one("ready",f)}};a.prototype.changeAct=function(f){var d=(uAdmin.eip&&uAdmin.eip.enabled)?"[id != 'edit'][id != 'ieditor-switcher']":"",c=jQuery("#save_edit");if(!f){jQuery("#u-quickpanel .act div:first").hide();jQuery("#u-quickpanel .act"+d).removeClass("act")}else{if(jQuery(f).hasClass("act")){jQuery("#u-quickpanel .act div:first").hide();jQuery("#u-quickpanel .act"+d).removeClass("act");if(f.id=="edit"){c.css("display","none")}}else{var e=jQuery("#u-quickpanel .act"),g=false;if(e.size()){jQuery("#u-quickpanel .act div:first").hide();jQuery("#u-quickpanel .act"+d).removeClass("act");if(f.id=="edit"&&!d){c.css("display","none")}}if(jQuery.browser.opera){g=jQuery(f).width()}jQuery(f).addClass("act");if(g){jQuery(f).width(g)}jQuery("#u-quickpanel .act div:first").show();if(f.id=="edit"){c.css("display","block")}}}if(jQuery(f).attr("id")!="meta"&&uAdmin.eip&&uAdmin.eip.meta.enabled){jQuery("#u-quickpanel #meta").addClass("act")}};a.prototype.editInAdmin=function(c){if(c=="enable"){jQuery(document).bind("keypress",this.editInAdmin.bindEvents)}if(c=="disable"){jQuery(document).unbind("keypress",this.editInAdmin.bindEvents)}};a.prototype.editInAdmin.bindEvents=function(c){if(c.shiftKey){switch(c.charCode||c.keyCode){case 68:case 100:case 1042:case 1074:jQuery("#u-quickpanel #edit_menu").each(function(d,e){uAdmin.panel.changeAct(e)});break}}};return b(a,this)});uAdmin(".tickets",function(b){function a(){var c=function(f){var d=this;d.params=f;(function e(){d.node=jQuery('<div class="u-ticket" />').appendTo("body");if(f.message){d.createMessage()}d.update()})()};c.prototype.resetSelection=function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var d=window.getSelection();if(d&&d.removeAllRanges){d.removeAllRanges()}}}};c.prototype.createMessage=function(){var d=this;d.messageNode=jQuery('<div class="u-ticket-comment"><div /><textarea /><a /></div>').appendTo("body");if(d.params.message){jQuery("div",d.messageNode).html(d.params.message.authorName+" ("+d.params.message.authorLogin+")");jQuery("textarea",d.messageNode).attr("value",d.params.message.text)}jQuery("a",d.messageNode).html(getLabel("js-ticket-delete"));jQuery("textarea",d.messageNode).bind("change",function(){d.save()});jQuery("a",d.messageNode).bind("click",function(){d.del()})};c.prototype.del=function(){var d=this;if(this.node){this.node.remove()}if(this.messageNode){this.messageNode.remove()}if(d.params.id){var e="/content/tickets/delete/"+d.params.id+"/";jQuery.get(e)}};c.prototype.save=function(){var d=this;var f=d.params.id?"modify":"create";var e="/content/tickets/"+f+"/"+d.params.id+"/";e+="?ts="+Math.round(Math.random()*1000);jQuery.ajax({type:"POST",url:e,dataType:"json",data:{x:d.params.x,y:d.params.y,width:d.params.width,height:d.params.height,message:jQuery("textarea",d.params.messageNode).attr("value"),referer:window.location.toString()},success:function(g){d.params.id=g.id}})};c.prototype.update=function(){var d=this;d.node.css({top:parseInt(d.params.y),left:parseInt(d.params.x),width:d.params.width,height:d.params.height,opacity:0.3});if(d.messageNode){d.messageNode.css({top:parseInt(d.params.y)+parseInt(d.params.height),left:parseInt(d.params.x)+parseInt(d.params.width)})}if(uAdmin.tickets.disabled){jQuery(d.node).add(d.messageNode).hide()}};c.prototype.listen=function(){var d=this,g=d.params.x,f=d.params.y,h,e;jQuery(document).bind("mousemove",function(j){d.resetSelection();h=j.pageX;e=j.pageY;if(h>g){d.params.width=h-g}else{h=g;d.params.x=j.pageX;d.params.width=h-d.params.x}if(e>f){d.params.height=e-f}else{e=f;d.params.y=j.pageY;d.params.height=e-d.params.y}d.update()});jQuery(document).one("mouseup",function(){jQuery(document).unbind("mousemove");d.update();d.save();uAdmin.tickets.isInit=false})};this.ticket=c}a.prototype.initNewTicket=function(){if(!uAdmin.tickets.created){alert(getLabel("js-panel-note-add"));uAdmin.tickets.created=true}if(uAdmin.tickets.isInit){return false}uAdmin.tickets.isInit=true;uAdmin.panel.changeAct(jQuery("#u-quickpanel #note").get(0));jQuery(document).one("mousedown",function(c){var d=new uAdmin.tickets.ticket({x:c.pageX,y:c.pageY,width:0,height:0,message:{authorName:uAdmin.tickets.user.fname+" "+uAdmin.tickets.user.lname,authorLogin:uAdmin.tickets.user.login,text:getLabel("js-ticket-empty")}});d.listen();uAdmin.panel.changeAct(jQuery("#u-quickpanel #note").get(0))})};a.prototype.swapVisible=function(){this.disabled?this.enable():this.disable()};a.prototype.disable=function(){var c=this;jQuery("div.u-ticket, div.u-ticket-comment, #u-quickpanel #note").hide();jQuery(document).unbind("keydown",c.bindEvents);jQuery("#u-quickpanel #note").unbind("click",c.bindEvents);c.disabled=true};a.prototype.enable=function(){var c=this;jQuery("div.u-ticket, div.u-ticket-comment, #u-quickpanel #note").show();jQuery(document).bind("keydown",c.bindEvents);jQuery("#u-quickpanel #note").bind("click",c.bindEvents);c.disabled=false};a.prototype.bindEvents=function(c){if((c.shiftKey&&(c.keyCode==67||c.keyCode==99)&&(c.target.nodeName!="INPUT"&&c.target.nodeName!="TEXTAREA"))||(c.type=="click"&&document.getElementById("note").id=="note")){uAdmin.tickets.initNewTicket()}};a.prototype.draw=function(f){uAdmin.tickets.user=f.user;var d;for(d in f.tickets.ticket){d=f.tickets.ticket[d];var g=d.position,e=d.author;var c=new this.ticket({id:d.id,x:g.x,y:g.y,width:g.width,height:g.height,message:{authorName:e.fname+" "+e.lname,authorLogin:e.login,text:d.message}});c.update()}};a.prototype.disabled=true;a.prototype.isInit=false;return b(a,this)});uAdmin(".eip",function(b){function a(){this.isMac=(navigator.userAgent.indexOf("Mac OS")!=-1);this.drawControls();if(uAdmin.data&&uAdmin.data.pageId){this.metaInit()}else{uAdmin.onLoad("data",function(){uAdmin.eip.metaInit()})}this.bindEditorEvents();if(!uAdmin.tickets&&uAdmin.panel){uAdmin.onLoad("tickets",this.activateByCookie)}else{if(uAdmin.tickets&&!uAdmin.panel){uAdmin.onLoad("panel",this.activateByCookie)}else{uAdmin.onLoad("eip",this.activateByCookie)}}this.init();this.bindGlobalEvents()}a.prototype.init=function(){this.deleteButtonsTimeout=null;this.initEditBoxes()};a.prototype.initEditBoxes=function(){var c=this;jQuery(".u-eip-edit-box").live("mouseover",function(){c.editBoxMouseoverHandler(this)});jQuery(".u-eip-edit-box-hover").live("mouseout",function(){c.editBoxMouseoutHandler(this)})};a.prototype.editBoxMouseoverHandler=function(d){var c=this,e=jQuery(d).addClass("u-eip-edit-box-hover"),f=c.searchAttr(d);if(e.attr("umi:delete")&&f.id){c.addDeleteButton(d,f)}else{c.dropDeleteButtons()}d.onclick=function(g){d.onclick=function(){return true};if(window.event){return window.event.ctrlKey}else{return g.ctrlKey}}};a.prototype.editBoxMouseoutHandler=function(d){var e=jQuery(d).removeClass("u-eip-edit-box-hover"),c=this;if(e.attr("umi:delete")){c.deleteButtonsTimeout=setTimeout(c.dropDeleteButtons,500)}e.click(function(){return true})};a.prototype.addDeleteButton=function(d,e){var c=this;if(this.deleteButtonsTimeout){clearTimeout(this.deleteButtonsTimeout)}this.dropDeleteButtons();var f=document.createElement("div");jQuery(f).attr("class","eip-del-button");document.body.appendChild(f);c.placeWith(d,f,"right","middle");jQuery(f).bind("mouseover",function(){if(c.deleteButtonsTimeout){clearTimeout(c.deleteButtonsTimeout)}}).bind("mouseout",function(){c.deleteButtonsTimeout=setTimeout(c.dropDeleteButtons,500)}).bind("click",function(){e["delete"]=true;c.queue.add(e);uAdmin.eip.normalizeBoxes()});return f};a.prototype.dropDeleteButtons=function(){jQuery(".eip-del-button").remove()};a.prototype.bindGlobalEvents=function(){this.bindKeyboardShortcut();window.onresize=function(){uAdmin.eip.normalizeBoxes()}};a.prototype.bindKeyboardShortcut=function(){jQuery(document).bind("keydown",function(c){if(c.keyCode==113){uAdmin.eip.swapEditor()}})};a.prototype.activateByCookie=function(){if(jQuery.cookie("eip-editor-state")){uAdmin.eip.swapEditor()}else{uAdmin.tickets.enable();uAdmin.panel.editInAdmin("enable")}};a.prototype.drawControls=function(){this.editorToggleButton=this.addEditorToggleButton();this.editorControlsHolder=this.addEditorControlsHolder();this.saveButton=this.addSaveButton();this.undoButton=this.addUndoButton();this.redoButton=this.addRedoButton()};a.prototype.addEditorControlsHolder=function(){return jQuery('\n			<div id="save_edit"></div>\n		').appendTo(uAdmin.panel.eipHolder)};a.prototype.addSaveButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="save" title="'+getLabel("js-panel-save")+" ("+(this.isMac?"Cmd":"Ctrl")+'+S)">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.save();return false})};a.prototype.addUndoButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="edit_back" title="'+getLabel("js-panel-cancel")+" ("+(this.isMac?"Cmd":"Ctrl")+'+Z)">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.back();return false})};a.prototype.addRedoButton=function(){var c=this;if(!this.editorControlsHolder){return null}return jQuery('\n			<div id="edit_next" title="'+getLabel("js-panel-repeat")+" ("+(this.isMac?"Cmd+Shift+Z":"Ctrl+Y")+')">&#160;</div>\n		').appendTo(this.editorControlsHolder).click(function(){c.queue.forward();return false})};a.prototype.addEditorToggleButton=function(){var c=this,d=jQuery('\n				<div id="edit">\n					<span class="in_ico_bg">&#160;</span>\n					<span class="edit-button-label"></span> (F2)				</div>\n			');d.appendTo(uAdmin.panel.eipHolder).click(function(){c.swapEditor();return false});d.setLabelText=function(e){if(e){d.find(".edit-button-label").text(e)}};d.setLabelText(getLabel("js-panel-edit"));return d};a.prototype.metaInit=function(){var c=this;this.meta.element_id=uAdmin.data.pageId;this.meta.old={alt_name:uAdmin.data.page["alt-name"]?uAdmin.data.page["alt-name"]:"",title:uAdmin.data.title?uAdmin.data.title:"",keywords:uAdmin.data.meta.keywords?uAdmin.data.meta.keywords:"",descriptions:uAdmin.data.meta.description?uAdmin.data.meta.description:""};this.meta["new"]={};this.metaToggleButton=this.addMetaToggleButton();this.metaPanel=this.addMetaPanel();this.metaSaveButton=this.getMetaSaveButton();this.metaPanel.find('input[type!="submit"]').bind("blur",function(f){var d=this.name.replace(/^meta_/g,"");c.meta["new"][d]=this.value}).bind("keyup mousedown blur",function(){var d=this.value.length;if(d>255){this.value=this.value.substring(0,255)}else{var e=this.id+"-count";jQuery("#"+e).html(d)}}).trigger("keyup")};a.prototype.addMetaToggleButton=function(){return jQuery('\n			<div id="meta">\n				<span class="in_ico_bg">&#160;</span>\n				'+getLabel("js-panel-meta")+"\n			</div>\n		").appendTo(uAdmin.panel.metaHolder).click(function(){uAdmin.panel.changeAct(this);uAdmin.eip.metaPanel.toggle();uAdmin.eip.meta.enabled=uAdmin.eip.metaPanel.is(":visible");return false})};a.prototype.addMetaPanel=function(){if(!uAdmin.panel.panelHolder){return null}var c=this;return jQuery('\n				<div id="u-quickpanel-meta">\n					<table>\n						<tr>\n							<td width="100px">'+getLabel("js-panel-meta-altname")+': </td>\n							<td>\n								<input type="text" name="alt_name" id="u-quickpanel-metaaltname" value="'+c.meta.old.alt_name+'"/>\n								<div class="meta_count" id="u-quickpanel-metaaltname-count"/>\n							</td>\n						</tr>\n						<tr>\n							<td width="100px">'+getLabel("js-panel-meta-title")+': </td>\n							<td>\n								<input type="text" name="title" id="u-quickpanel-metatitle" value="'+c.meta.old.title+'"/>\n								<div class="meta_count" id="u-quickpanel-metatitle-count"/>\n							</td>\n						</tr>\n						<tr>\n							<td>'+getLabel("js-panel-meta-keywords")+': </td>\n							<td>\n								<input type="text" name="meta_keywords" id="u-quickpanel-metakeywords" value="'+c.meta.old.keywords+'"/>\n								<div class="meta_count" id="u-quickpanel-metakeywords-count"/>\n								<div class="meta_buttons"><a href="/admin/seo/" style="color:white;">'+getLabel("js-panel-meta-analysis")+"</a></div>\n							</td>\n						</tr>\n						<tr>\n							<td>"+getLabel("js-panel-meta-descriptions")+':</td>\n							<td>\n								<input type="text" name="meta_descriptions" id="u-quickpanel-metadescription" value="'+c.meta.old.descriptions+'"/>\n								<div class="meta_count" id="u-quickpanel-metadescription-count"/>\n								<div class="meta_buttons">\n									<input type="submit" id="save_meta_button" value="'+getLabel("js-panel-save")+'">\n								</div>\n							</td>\n						</tr>\n					</table>\n				</div>\n			').appendTo(uAdmin.panel.panelHolder)};a.prototype.getMetaSaveButton=function(){if(!this.metaPanel){return null}var c=this;return this.metaPanel.find("#save_meta_button").click(function(){c.metaSave();return false})};a.prototype.metaSave=function(){var g={},d,c=this,f=0,e=0;for(d in c.meta["new"]){if(c.meta["new"][d]!=c.meta.old[d]){g["field-name"]=((d=="keywords"||d=="descriptions")?"meta_"+d:d);g["element-id"]=c.meta.element_id;g.value=c.meta["new"][d];f++;jQuery.post("/admin/content/editValue/save.json",g,function(h){if(h.error){c.message(h.error);return}e++;if(e==f){c.message(getLabel("js-panel-message-changes-saved"));uAdmin.eip.metaToggleButton.click()}},"json")}delete c.meta["new"][d]}};a.prototype.bindEditorEvents=function(){this.bind("Enable",this.enableEventHandler);this.bind("Disable",this.disableEventHandler);this.bind("Repaint",this.repaintEventHandler);this.bind("Save",this.saveEventHandler)};a.prototype.enableEventHandler=function(c){if(c=="after"){uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))}};a.prototype.disableEventHandler=function(c){if(c=="after"){uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))}};a.prototype.repaintEventHandler=function(c){};a.prototype.saveEventHandler=function(c){};a.prototype.swapEditor=function(){if(this.enabled){this.disable();this.editorToggleButton.setLabelText(getLabel("js-panel-edit"));jQuery("#on_edit_in_place").html(getLabel("js-on-eip"));uAdmin.tickets.enable();uAdmin.panel.editInAdmin("enable")}else{this.enable();this.editorToggleButton.setLabelText(getLabel("js-panel-view"));jQuery("#on_edit_in_place").html(getLabel("js-off-eip"));uAdmin.tickets.disable();uAdmin.panel.editInAdmin("disable")}this.bindEvents()};a.prototype.enable=function(){var c=this;c.onEnable("before");c.finishLast();c.inspectDocument();c.highlight();c.normalizeBoxes();jQuery(window).load(function(){setTimeout(function(){c.normalizeBoxes()},250)});c.enabled=true;if(c.queue.current>=0){c.queue.setSaveStatus(true)}var d=new Date();d.setTime(d.getTime()+(3*24*60*60*1000));jQuery.cookie("eip-editor-state","enabled",{path:"/",expires:d});c.message(getLabel("js-panel-message-edit-on"));jQuery(document).bind("keydown",c.bindHotkeys);c.onEnable("after")};a.prototype.disable=function(){this.onDisable("before");this.finishLast();this.unhighlight();this.enabled=false;jQuery.cookie("eip-editor-state","",{path:"/",expires:0});this.queue.setSaveStatus(false);this.message(getLabel("js-panel-message-edit-off"));if(this.queue.current>=0){if(confirm(getLabel("js-panel-message-save-confirm"))){this.queue.save()}}jQuery(document).unbind("keydown",this.bindHotkeys);this.onDisable("after")};a.prototype.bind=function(d,g){var c=this,e=(typeof c["on"+d]=="function")?c["on"+d]:function(){};c["on"+d]=function(h,f){e(h,f);g(h,f)}};a.prototype.trigger=function(e,d,c){if(typeof this["on"+e]=="function"){this["on"+e](d,c)}};a.prototype.bindHotkeys=function(d){var c=uAdmin.eip.queue;if(navigator.userAgent.indexOf("Mac OS")!=-1){if(d.metaKey){switch(d.keyCode){case 83:c.save();break;case 90:if(d.shiftKey){c.forward()}else{c.back()}break;default:return true}return false}}else{if(d.ctrlKey){switch(d.keyCode){case 83:c.save();break;case 90:c.back();break;case 89:c.forward();break;default:return true}return false}}return true};a.prototype.finishLast=function(){if(this.previousEditBox){this.previousEditBox.finish(true);this.previousEditBox=null}};a.prototype.normalizeBoxes=function(){var c=this;jQuery(c.listNodes).each(function(h,l){if(!l.boxNode){return}var f=c.nodePositionInfo(l);jQuery(l.boxNode).css({width:f.width,height:f.height,left:f.x,top:f.y});var j=l.addButtonNode;var k="bottom",e="left";if(j){var g;if((g=jQuery(l).attr("umi:button-position"))){var d=g.split(/ /);if(d.length==2){k=d[0];e=d[1]}}c.placeWith(l,j,k,e)}});c.onRepaint("after")};a.prototype.bindEvents=function(){var d=this,c=jQuery(".u-eip-edit-box");c.die("click");c.die("drop");c.die("dragexit");c.die("dragover");c.unbind("click");c.unbind("drop");c.unbind("dragexit");c.unbind("dragover");var e="click";if(navigator.userAgent.toLowerCase().indexOf("firefox")||navigator.userAgent.toLowerCase().indexOf("chrome")){e=e+" drop";c.live("dragexit",function(f){f.stopPropagation();f.preventDefault()});c.live("dragover",function(f){f.stopPropagation();f.preventDefault()})}c.live(e,function(j){var h=j.target;if(j.ctrlKey||(navigator.userAgent.indexOf("Mac OS")!=-1&&j.metaKey)){if(this.tagName=="A"){location.href=this.href}return true}var g=(typeof h.onclick=="function")?h.onclick:function(){};var k=function(){return false};h.onclick=k;setTimeout(function(){if(h&&g!=k){h.onclick=g}},100);for(var f=0;f<25;f++){if(!h){return false}if(h.tagName!="TABLE"&&jQuery(h).attr("umi:field-name")){break}h=h.parentNode}if(!h){return false}j.stopPropagation();j.stopImmediatePropagation();j.preventDefault();d.edit(h,j&&j.originalEvent&&j.originalEvent.dataTransfer?j.originalEvent.dataTransfer.files:null);j.stopPropagation();j.stopImmediatePropagation();j.preventDefault();return false});window.onbeforeunload=function(){if(uAdmin.eip.queue.current>=0||uAdmin.eip.queue.save.count>0){return getLabel("js-panel-message-save-before-exit")}}};a.prototype.inspectDocument=function(){var c=this;c.editNodes=[];c.listNodes=[];var d=c.getRegions();d.each(function(e,f){if(jQuery(f).css("display")=="none"){return}c.inspectNode(f)})};a.prototype.inspectNode=function(c){if(c.tagName=="TABLE"){return}if(jQuery(c).attr("umi:field-name")){this.editNodes.push(c)}if(jQuery(c).attr("umi:module")){this.listNodes.push(c)}if(jQuery.browser.msie){jQuery(c).parents("a:first").each(function(){var d=this.href;jQuery(this).click(function(f){if(f.ctrlKey){window.location.href=d}});this.removeAttribute("href")})}};a.prototype.getRegions=function(){return jQuery("*[umi\\:field-name], *[umi\\:module]")};a.prototype.isParentOf=function(d,c){if(!c||!d){return false}if(c==d){return true}if(d.parentNode){return this.isParentOf(d.parentNode,c)}return false};a.prototype.highlight=function(d,c){var e=this;if(e.highlighted){e.unhighlight()}e.highlighted=true;jQuery(e.editNodes).each(function(f,g){if(e.isParentOf(g,d)==false){e.highlightNode(g)}});if(!c){jQuery(e.listNodes).each(function(f,g){if(e.isParentOf(g,d)==false){e.highlightListNode(g)}})}e.onRepaint("after");e.markInversedBoxes()};a.prototype.unhighlight=function(){var c=jQuery(".u-eip-edit-box");c.each(function(d,e){e=jQuery(e);var f=e.attr("umi:empty");if(f&&(e.attr("tagName")!="IMG")&&(e.html()==f)){e.html("")}e.attr("title","")});c.removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-edit-box-inversed");c.unbind("click");c.unbind("mouseover");c.unbind("mouseout");c.unbind("mousedown");c.unbind("mouseup");jQuery(".u-eip-add-box, .u-eip-add-button, .u-eip-del-button").remove();jQuery(".u-eip-sortable").sortable("destroy");jQuery(".u-eip-sortable").removeClass("u-eip-sortable")};a.prototype.highlightNode=function(d){if(!jQuery(d).attr("umi:field-name")){return}var h=this.searchAttr(d);if(!h){return}var f=this.htmlTrim(jQuery(d).attr("umi:empty"));if(f&&this.htmlTrim(jQuery(d).html())==""&&(jQuery(d).attr("tagName")!="IMG")){try{jQuery(d).html(f)}catch(g){}jQuery(d).addClass("u-eip-empty-field")}jQuery(d).addClass("u-eip-edit-box");if(this.queue.search(h)){jQuery(d).addClass("u-eip-modified")}if(d.tagName=="A"||d.parentNode.tagName=="A"||jQuery("a",d).size()>0){var c=getLabel("js-panel-link-to-go");if(navigator.userAgent.indexOf("Mac OS")!=-1){c=c.replace(/Ctrl/g,"Cmd")}jQuery(d).attr("title",c);jQuery(d).bind("dblclick",function(){return false})}else{jQuery(d).attr("title","")}this.markInversedBoxes(jQuery(d))};a.prototype.searchAttr=function(d,h,c){if(!d){return false}var f;c=c||20;if(d.tagName=="BODY"||d.tagName=="TABLE"){return false}if(!this.searchAttr.info.node&&jQuery(d).attr("umi:field-name")){this.searchAttr.info.node=d;var g=jQuery(d).attr("umi:field-name");if(!g&&typeof h!="function"){this.message("You should specify umi:field-name attribute");return false}if(!this.searchAttr.info.field_name){this.searchAttr.info.field_name=g}}var e=jQuery(d);if(typeof h!="function"||h(d)){if(e.attr("umi:element-id")){this.searchAttr.info.id=e.attr("umi:element-id");this.searchAttr.info.type="element";f=this.searchAttr.info;this.searchAttr.info={};return f}else{if(e.attr("umi:object-id")){this.searchAttr.info.id=e.attr("umi:object-id");this.searchAttr.info.type="object";f=this.searchAttr.info;this.searchAttr.info={};return f}}}if(d.parentNode){return this.searchAttr(d.parentNode,h,--c)}this.message("You should specify umi:element-id or umi:object attribute");return false};a.prototype.searchAttr.info={};a.prototype.searchRow=function(d,c){if(c){if(d.tagName=="BODY"||d.tagName=="TABLE"){return false}if(jQuery(d.parentNode).attr("umi:region")){return d.parentNode}else{return this.searchRow(d.parentNode,true)}}else{return jQuery("*[umi\\:region]",d).filter(function(){var e='[umi\\:element-id^="new"], [umi\\:object-id^="new"]';return !jQuery(this).find(e).length&&!jQuery(this).is(e)}).get(0)}};a.prototype.searchRowId=function(d){var c=jQuery(d).attr("umi:element-id");return c||(jQuery("*[umi\\:element-id]",d).length?jQuery("*[umi\\:element-id]",d).get(0).attr("umi:element-id"):null)};a.prototype.inlineAddPage=function(p){var n=this,f=n.searchRow(p);if(!f){n.message("Error, umi:region=row is not defined");return false}p=jQuery(p);var q={element:p.attr("umi:element-id"),object:p.attr("umi:object-id")},j=p.attr("umi:type-id");var g=false;jQuery(".u-eip-deleted").each(function(w,x){if(n.searchAttr(x).id==(q.element||q.object)){g=true;return}});if(g){n.message(getLabel("js-panel-message-cant-add"));return false}if(!j&&q.element){if(q.element.match(/^new/g)){var k=n.queue.search({id:q.element});j=k.type_id}else{var v=jQuery.ajax({url:"/admin/content/getTypeAdding/"+q.element+"/.json",async:false,dataType:"json"});v=JSON.parse(v.responseText);j=v.result}}if(!j){n.message("Error, umi:type-id is not defined");return false}var u=(p.attr("umi:method")=="lastlist"||jQuery(p).attr("umi:add-prepend")=="prepend"),d=jQuery(f).clone(),h=(u)?d.prependTo(f.parentNode):d.appendTo(f.parentNode);h.removeClass("blank_item");var m=function(y){var x,w;if(jQuery(y).attr("umi:field-name")){return y}else{if(y.children){for(w=0;w<y.children.length;w++){x=m(y.children[w]);if(x){return x}}}}return false};d=m(h.get(0));if(!d){n.message("Error, umi:field-name is not defined");return false}var s=n.searchAttr(d);s.id="new_"+new Date().getTime();s.type_id=j;s.add=true;s.node=h.get(0);if(q.object){s.parent=q.object;s.type="object"}if(q.element){s.parent=q.element;s.type="element"}delete s.field_name;if(jQuery(f).attr("umi:"+s.type+"-id")==""){jQuery(f).remove();jQuery(h).attr("umi:"+s.type+"-id",s.id);jQuery("*",h).each(function(w,x){if(!x.children.length){x.style.display=""}})}var e=jQuery.ajax({url:"/admin/content/getTypeFields/"+j+"/.json",async:false,dataType:"json"});e=jQuery.parseJSON(e.responseText);var o=[];for(var r in e){if(parseInt(r)==r){o.push(e[r])}}o.push("name");var c=function(w){var y="umi:"+s.type+"-id";if(jQuery(w).attr("tagName")=="TABLE"){return}if(jQuery(w).attr("umi:field-name")){if(jQuery.inArray(jQuery(w).attr("umi:field-name"),o)==-1){return false}var x=jQuery(w).attr("umi:empty");if(jQuery(w).attr("tagName")=="IMG"&&x){jQuery(w).attr("src",x)}if(jQuery(w).is("img")&&x){jQuery(w).attr("src",x)}else{jQuery(w).html(x?x:"")}jQuery(w).addClass("u-eip-empty-field");n.editNodes[n.editNodes.length]=w}if(jQuery(w).attr(y)){jQuery(w).attr("umi:clone-source-id",jQuery(w).attr(y));jQuery(w).attr(y,s.id)}};var l=jQuery('*[umi\\:region="row"]',h).get(0);jQuery('*[umi\\:region="row"]',h).remove();c(h);h.addClass("u-eip-newitem");var t=jQuery("*",h);t.each(function(w,x){n.inspectNode(x);n.highlightListNode(x);if(jQuery(x).attr("umi:region")){jQuery(x).html(l);jQuery("*",x).each(function(y,z){z=jQuery(z);if(!z.children().length){z.text("");z.css("display","none")}if(z.attr("href")){z.attr("href","")}if(z.attr("umi:"+s.type+"-id")){z.attr("umi:"+s.type+"-id","")}})}c(x)});n.queue.add(s);n.normalizeBoxes();return true};a.prototype.onSuccessAddNewPage=function(c){if(!c||c.forceReload){document.location.reload();return false}var d=jQuery("[umi\\:element-id="+c.parentId+"][umi\\:region=list]");if(!d.length){return false}var e=function(g,f){g.removeClass("current blank_item");if(g.is("[umi\\:url-attribute]")){g.attr(g.attr("umi:url-attribute"),f.url)}else{if(g.is("a")){g.attr("href",f.url)}}if(g.is("[umi\\:element-id]")){g.attr("umi:element-id",f.elementId)}if(g.is("[umi\\:field-name=name]")){g.text(f.title)}g.children().each(function(){e(jQuery(this),f)})};d.each(function(){var f=jQuery(this);var g=f.find("[umi\\:region=row]").first().clone();e(g,c);g.appendTo(f)});jQuery.closePopupLayer(null,{})};a.prototype.htmlTrim=function(c){c=jQuery.trim(c);return c.replace(/<br ?\/?>/g,"").replace(/<p><\/p>/g,"")};a.prototype.markInversedBoxes=function(c){setTimeout(function(){if(!c){c=jQuery(".u-eip-edit-box")}c.each(function(e,g){var d=new RGBColor(jQuery(g).css("color"));var f=d.toHash();var h=(f.red/255+f.green/255+f.blue/224)/3;if(h>=0.9){jQuery(g).addClass("u-eip-edit-box-inversed")}})},500)};a.prototype.highlightListNode=function(f){var d=this;if(!jQuery(f).attr("umi:module")){return false}var e=document.createElement("div");document.body.appendChild(e);f.boxNode=e;var c=d.nodePositionInfo(f);if(!c.x&&!c.y){return false}jQuery(e).attr("class","u-eip-add-box");jQuery(e).css({position:"absolute",width:c.width,height:c.height,left:c.x,top:c.y});if(jQuery(f).attr("umi:add-method")!="none"){this.addAddButton(f,e)}if(jQuery(f).attr("umi:sortable")=="sortable"){this.setNodeSortable(f,e)}return e};a.prototype.addAddButton=function(k,j){var g=document.createElement("a");k.addButtonNode=g;jQuery(g).attr({"class":"u-eip-add-button"}).html(getLabel("js-panel-add"));jQuery(g).hover(function(){jQuery(this).addClass("u-eip-add-button-hover")},function(){jQuery(this).removeClass("u-eip-add-button-hover")});var h="bottom";var d="left";var f;if(f=jQuery(k).attr("umi:button-position")){var c=f.split(/ /);if(c.length==2){h=c[0];d=c[1]}}this.placeWith(k,g,h,d);var e=this;jQuery(g).bind("mouseup",function(){e.onAddButtonMouseup(k)}).bind("mouseover",function(){e.onAddButtonMouseover(j)}).bind("mouseout",function(){e.onAddButtonMouseout(j)});document.body.appendChild(g)};a.prototype.onAddButtonMouseup=function(g){var m=this;var k=jQuery(g).attr("umi:region");var e=m.searchRow(g);var j=jQuery(g).attr("umi:element-id");var f=jQuery(g).attr("umi:module");var c=jQuery(g).attr("umi:method");var h=jQuery(g).attr("umi:add-method");if(e&&(k=="list")&&(h!="popup")){m.inlineAddPage(g)}else{if(m.queue.current>=0){m.message(getLabel("js-panel-message-save-first"));return}var d="/admin/content/eip_add_page/choose/"+parseInt(j)+"/"+f+"/"+c+"/",l=uAdmin.csrf?"?csrf="+uAdmin.csrf:"";jQuery.ajax({url:d+".json"+l,dataType:"json",success:function(n){if(n.data.error){uAdmin.eip.message(n.data.error);return}jQuery.openPopupLayer({name:"CreatePage",title:getLabel("js-eip-create-page"),url:d+l})},error:function(){uAdmin.eip.message(getLabel("error-require-more-permissions"));return}})}};a.prototype.onAddButtonMouseover=function(c){jQuery(c).addClass("u-eip-add-box-hover")};a.prototype.onAddButtonMouseout=function(c){jQuery(c).removeClass("u-eip-add-box-hover")};a.prototype.setNodeSortable=function(c,f){var l=this;jQuery(c).addClass("u-eip-sortable");var d=null,k=null,j,e,h=false,g=[];jQuery("*").each(function(p,q){if(q.tagName=="TABLE"){return}if(jQuery(q).attr("umi:sortable")!="sortable"){return}var o=false;jQuery(q).parents().each(function(r,n){if(n==c){o=true}});if(o){return}var m=false;jQuery("*",q).each(function(r,n){if(n==c){m=true}});if(m){return}g.push(q)});jQuery(c).sortable({items:'> [umi\\:region="row"]',tolerance:"pointer",cursor:"move",dropOnEmpty:true,revert:true,forcePlaceholderSize:true,placeholder:"u-eip-sortable-placeholder",update:function(p,q){j=q.item[0];if(!jQuery(j).hasClass("u-eip-newitem")&&!(window.cloudController&&window.cloudController.onController)){var o=jQuery.ajax({url:"/admin/content/eip_move_page/"+jQuery(j).attr("umi:element-id")+"/.json?check",async:false,dataType:"json",type:"GET"});var n=jQuery.parseJSON(o.responseText);if(n.error){jQuery(c).sortable("cancel");uAdmin.eip.message(n.error);return false}}var m=j.nextSibling;do{if(!m){break}if(m.nodeType!=1){continue}if(l.searchRowId(m)){break}}while(m=m.nextSibling);d=m;k=j.parentNode;var r=l.searchAttr(j.parentNode,function(t){return jQuery(t).attr("umi:sortable")=="sortable"});var s=parseInt(r?r.id:null);r.node=j;r.move=true;r.moved=l.searchRowId(j);r.next=m;r.old_next=d;r.parent_id=s;r.parent=j.parentNode;r.old_parent=k;delete r.field_name;d=null;k=null;l.normalizeBoxes();l.queue.add(r)}})};a.prototype.nodePositionInfo=function(c){c=jQuery(c);return{width:c.innerWidth(),height:c.innerHeight(),x:c.offset().left,y:c.offset().top}};a.prototype.placeWith=function(c,d,n,h){if(!c||!d){return}var g=this.nodePositionInfo(c);var l=jQuery(d);var m,k;switch(n){case"top":k=g.y-parseInt(l.css("height"));break;case"right":m=g.x+g.width;break;case"left":m=g.x-l.width();break;default:k=g.y+g.height}if(n=="top"||n=="bottom"){switch(h){case"right":m=g.x+g.width-l.width();break;case"middle":case"center":if(g.width-parseInt(l.css("width"))>0){m=g.x+Math.ceil((g.width-l.width())/2)}else{m=g.x}break;default:m=g.x;m+=parseInt(jQuery(c).css("padding-left"))}}else{switch(h){case"top":k=g.y;break;case"bottom":k=g.y+g.height-parseInt(l.css("height"));break;default:if(g.height-parseInt(l.css("height"))>0){k=g.y+Math.ceil((g.height-parseInt(l.css("height")))/2)}else{k=g.y}}}var o=l.width()+m;var f=jQuery(window);if(o>f.width()){m=f.width()-l.width()-30}try{l.css({position:"absolute",left:m+"px",top:k+"px","z-index":560})}catch(j){}};a.prototype.applyStyles=function(f,h,c){var e=["font-size","font-family","font-name","margin-left","margin-right","margin-top","margin-bottom","font-weight"],d;f=jQuery(f);h=jQuery(h);for(d in e){var g=e[d];h.css(g,f.css(g))}if(c!==false){h.width(f.outerWidth());h.height(f.outerHeight())}};a.prototype.message=function(c){jQuery.jGrowl("<p>"+c+"</p>",{header:"UMI.CMS",life:10000})};a.prototype.edit=function(d,c){if(jQuery(d).hasClass("u-eip-deleted")||jQuery(d).parents().hasClass("u-eip-deleted")){this.message(getLabel("js-panel-message-cant-edit"));return false}this.finishLast();jQuery(".eip-del-button").remove();this.previousEditBox=this.editor.get(d,c);if(this.previousEditBox){jQuery(".u-eip-add-button, .u-eip-add-box").css("display","none")}jQuery(d).removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-empty-field u-eip-edit-box-inversed");if(this.previousEditBox){jQuery(d).addClass("u-eip-editing")}var e=this.trim(jQuery(d).attr("umi:empty"));if(e&&this.trim(jQuery(d).html())==e){jQuery(d).html("&nbsp;");jQuery(d).removeClass("u-eip-empty-field")}return true};a.prototype.trim=function(c){c=jQuery.trim(c);return c.replace(/<br ?\/?>/g,"").replace(/<p><\/p>/g,"")};a.prototype.queue=[];a.prototype.queue.add=function(c){if(this.current==-1){this.setSaveStatus(true)}if(this.current<this.length-1){for(var d=this.length-1;d>this.current;d--){this.pop()}this.current=(this.length)}else{++this.current}this.push(c);this.step();if(c.add){uAdmin.eip.message(getLabel("js-panel-message-add-after-save"));jQuery(c.node).css("display","")}if(c.move){jQuery(c.node.parentNode).addClass("u-eip-modified")}if(c["delete"]){uAdmin.eip.message(getLabel("js-panel-message-delete-after-save"));jQuery(c.node).addClass("u-eip-deleted")}jQuery(c.node).addClass("u-eip-modified");return this.length};a.prototype.queue.get=function(c){if(!parseInt(c)){c=this.current}return this[c]||null};a.prototype.queue._saveStatus=false;a.prototype.queue.setSaveStatus=function(d){var c=uAdmin.eip;if(d){jQuery("#save").addClass("save_me");c.editorToggleButton.setLabelText(getLabel("js-panel-edit-save"))}else{jQuery("#save").removeClass("save_me");c.editorToggleButton.setLabelText(c.enabled?getLabel("js-panel-view"):getLabel("js-panel-edit"))}uAdmin.eip.queue._saveStatus=d};a.prototype.queue.getSaveStatus=function(c){return uAdmin.eip.queue._saveStatus};a.prototype.queue.search=function(c){var d=this.current;while(d>=0){if(this[d].id==c.id&&(this[d].field_name==c.field_name||(this[d].add&&c.add)||(this[d].move&&c.move)||(this[d]["delete"]&&c["delete"])||(this[d].custom&&c.custom))){return this[d]}--d}return false};a.prototype.queue.back=function(c){c=parseInt(c)||1;while(c--){if(this[this.current]){this.cancel()}}uAdmin.eip.normalizeBoxes();this.step()};a.prototype.queue.forward=function(c){c=parseInt(c)||1;while(c--){if(this[this.current+1]){this.apply()}}uAdmin.eip.normalizeBoxes();this.step()};a.prototype.queue.apply=function(){uAdmin.eip.finishLast();++this.current;var c=this.get();if(!c.add&&!c.move&&!c["delete"]&&!c.custom&&!uAdmin.eip.editor.replace(c,c.new_value,c.old_value)){--this.current}else{switch(true){case c.add:uAdmin.eip.message(getLabel("js-panel-message-add-after-save"));jQuery(c.node).css("display","");break;case c["delete"]:uAdmin.eip.message(getLabel("js-panel-message-delete-after-save"));jQuery(c.node).addClass("u-eip-deleted");break;case c.move:if(c.next){jQuery(c.node).insertBefore(c.next)}else{jQuery(c.node).appendTo(c.parent)}jQuery(c.node).addClass("u-eip-modified");jQuery(c.parent).addClass("u-eip-modified");break;case c.custom:if(c.target&&c.target.forward){c.target.forward()}break;default:jQuery(c.node).addClass("u-eip-modified")}}if(this.current==0){this.setSaveStatus(true)}};a.prototype.queue.cancel=function(){uAdmin.eip.finishLast();var d=this.get(),c=false;switch(true){case d.add:--this.current;jQuery(d.node).css("display","none");break;case d["delete"]:--this.current;jQuery(d.node).removeClass("u-eip-deleted");break;case d.move:--this.current;if(d.old_next){jQuery(d.node).insertBefore(d.old_next)}else{jQuery(d.node).appendTo(d.old_parent)}jQuery(d.node).removeClass("u-eip-modified");if(!this.search(d)){jQuery(d.parent).removeClass("u-eip-modified")}break;case d.custom:--this.current;if(d.target&&d.target.back){d.target.back()}break;default:c=uAdmin.eip.editor.replace(d,d.old_value,d.new_value);if(c){--this.current;jQuery(d.node).addClass("u-eip-modified")}}if(d.add||d.move||d["delete"]||d.custom||c){if(!this.search(d)){jQuery(d.node).removeClass("u-eip-modified")}if(this.current==-1){this.setSaveStatus(false);uAdmin.eip.message(getLabel("js-panel-message-changes-revert"))}}};a.prototype.queue.step=function(){if(this.length){jQuery("#u-quickpanel #save_edit #edit_back").attr("class",(this.current==-1)?"":"ac");jQuery("#u-quickpanel #save_edit #edit_next").attr("class",((this.length-this.current)==1)?"":"ac")}};a.prototype.queue.save=function(j){uAdmin.eip.finishLast();if(this.current==-1&&!j){return false}var c=this,g=false,k={},d=jQuery("div.popupText span",c.progress);switch(j){case"add":for(e in c.save.add){g=c.save.add[e];delete c.save.add[e];break}if(g){for(e in c.save.added){if(g.parent==e){g.parent=c.save.added[e]}}var f="/admin/content/eip_quick_add/"+g.parent+".json?type-id="+g.type_id;if(jQuery(g.node).attr("umi:module")!="data"){f+="&force-hierarchy=1"}jQuery.get(f,function(n){if(n.error){uAdmin.eip.message(n.error);return}var o=parseInt(n.data["element-id"]);var s=parseInt(n.data["object-id"]);c.save.added[g.id]=o||s;jQuery(g.node).removeClass("u-eip-newitem u-eip-modified");jQuery(g.node).attr("umi:"+g.type+"-id",o||s);jQuery("*[umi\\:"+g.type+'-id="'+g.id+'"]',g.node).attr("umi:"+g.type+"-id",o||s);var m=jQuery(g.node);var l=o||s;var p=g.parent;var q=m.parents("[umi\\:region=list]").first();var u=q.attr("umi:add-prepend")=="prepend";var t=function(x,w,v){v=!!v;if(x.attr("umi:element-id")){x.attr("umi:element-id",w.attr("umi:element-id")||l)}if(x.attr("umi:object-id")){x.attr("umi:object-id",w.attr("umi:object-id")||l)}if(x.is("img")){x.attr("src",w.attr("src"))}else{if(v&&x.is("a")){x.attr("href",w.attr("href"))}if(x.is("[umi\\:field-name]")){if(w.attr("umi:empty")){x.attr("umi:empty",w.attr("umi:empty"))}if(x.attr("umi:empty")){x.addClass("u-eip-empty-field")}else{x.removeClass("u-eip-empty-field")}x.text(w.text()||w.attr("umi:empty")||"")}}};var r=q.attr("umi:type-id");jQuery("[umi\\:"+g.type+"-id="+p+"][umi\\:region=list]").filter(function(){return jQuery(this).find("[umi\\:"+g.type+"-id="+l+"]").length==0}).filter(function(){var v=false,w=jQuery(this).attr("umi:type-id");if((!w&&!r)||w==r){v=true}return v}).each(function(){var v=jQuery(this),x=v.children("[umi\\:region=row]:first").clone().removeClass("blank_item current"),w=m.find("*").andSelf().filter("[umi\\:url-attribute]").first();if(w.length){var z=w.attr("umi:url-attribute"),y=x.find("*").andSelf();if(y.filter("[umi\\:url-attribute]").attr(z,w.attr(z)).length==0){y.filter("a").attr("href",w.attr(z))}t(x,m)}else{t(x,m,true)}m.find("[umi\\:field-name]").each(function(){var A=jQuery(this);var B=A.attr("umi:field-name");x.find("[umi\\:field-name="+B+"]").each(function(){t(jQuery(this),A)})});if(u){x.prependTo(v)}else{x.appendTo(v)}v.find("[umi\\:field-name]").each(function(){uAdmin.eip.highlightNode(this)})});g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("add")},"json")}else{c.save("move")}break;case"move":for(e in c.save.move){g=c.save.move[e];delete c.save.move[e];break}if(g){g.next=(g.next==null?"":uAdmin.eip.searchRowId(g.next));for(e in c.save.added){if(g.parent_id==e){g.parent_id=c.save.added[e]}if(g.moved==e){g.moved=c.save.added[e]}if(g.next==e){g.next=c.save.added[e]}}jQuery.post("/admin/content/eip_move_page/"+g.moved+"/"+g.next+".json",{"parent-id":g.parent_id},function(l){if(l.error){uAdmin.eip.message(l.error);return}jQuery(g.node).removeClass("u-eip-modified");jQuery(g.node).parent().removeClass("u-eip-modified");jQuery("[umi\\:region=list]").filter("[umi\\:element-id="+g.parent_id+"], [umi\\:object-id="+g.parent_id+"]").filter(function(){return this!=g.parent}).each(function(){var n=jQuery(g.node).index(),o=jQuery(this).find("[umi\\:region=row][umi\\:"+g.type+"-id="+g.moved+"]"),m=jQuery(this).children().eq(n);if(o.index()>n){o.insertBefore(m)}else{if(o.index()<n){o.insertAfter(m)}}});uAdmin.eip.normalizeBoxes();if(uAdmin.eip.enabled){uAdmin.eip.highlight(g.moved)}uAdmin.eip.message(getLabel("js-panel-message-page-moved"));--c.save.count;d.text(parseInt(d.text())+1);c.save("move")},"json")}else{c.save("edit")}break;case"edit":for(e in c.save.edit){g=c.save.edit[e];delete c.save.edit[e];break}if(g){for(e in c.save.added){if(g.id==e){g.id=c.save.added[e]}}if(uAdmin.eip.editor.equals(g.new_value,g.old_value)){jQuery(g.node).removeClass("u-eip-modified");g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("edit")}else{k={};k[g.type+"-id"]=g.id;k.qt=new Date().getTime();k["field-name"]=g.field_name;var h,e;switch(typeof g.new_value){case"object":if(g.new_value.src){h=g.new_value.src}else{h=[];for(e in g.new_value){h.push(e)}}break;case"string":if(jQuery.browser.mozilla&&g.new_value.match(/="\.\.\//g)){g.new_value=g.new_value.replace(/="[\.\.\/]+/g,'="/')}h=g.new_value.replace(/\sumi:[-a-z]+="[^"]*"/g,"");break;default:h=g.new_value}k.value=h;jQuery.post("/admin/content/editValue/save.json",k,function(p){if(p.error){uAdmin.eip.message(p.error);return}var n=p.property["new-link"],q=p.property["old-link"];var m=jQuery(g.node).parents("[umi\\:element-id], [umi\\:object-id]").first(),s=m.is("[umi\\:object-id]")?"object":"element",r=m.attr("umi:"+s+"-id"),l=jQuery("[umi\\:"+s+"-id="+r+"]");if(!l.length){l=jQuery(g.node).parent()}if(q&&n){var o=0;l.each(function(){jQuery(this).find("[umi\\:url-attribute]").each(function(){jQuery(this).attr(jQuery(this).attr("umi:url-attribute"),n).bind("click mousedown mouseup",function(){return true});o++})});if(!o){l.find("a").each(function(t,u){jQuery(this).attr("href",n).bind("click mousedown mouseup",function(){return true})})}}jQuery("[umi\\:"+g.type+"-id='"+g.id+"']").find("[umi\\:field-name="+p.property.name+"]").add("[umi\\:"+g.type+"-id='"+g.id+"'][umi\\:field-name="+p.property.name+"]").each(function(){var t=jQuery(this);if(t.is("img")){t.attr("src",p.property.value["src"])}else{t.html(g.node.innerHTML)}t.parents(".not_hidden").removeClass("not_hidden")});jQuery(g.node).removeClass("u-eip-modified");g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("edit")},"json")}}else{c.save("custom")}break;case"custom":for(e in c.save.custom){g=c.save.custom[e];delete c.save.custom[e];break}if(g){if(g.target&&g.target.save&&typeof g.target.save=="function"){g.target.save()}d.text(parseInt(d.text())+1);--c.save.count;c.save("custom")}else{c.save("del")}break;case"del":for(e in c.save.del){g=c.save.del[e];delete c.save.del[e];break}if(g){for(e in c.save.added){if(g.id==e){g.id=c.save.added[e]}}k={};k[g.type+"-id"]=g.id;k.qt=new Date().getTime();jQuery.post("/admin/content/eip_del_page.json",k,function(m){if(m.error){uAdmin.eip.message(m.error)}else{var l=uAdmin.eip.searchRow(g.node,true);if(l){jQuery(l).remove()}else{jQuery(g.node).remove()}jQuery("[umi\\:element-id="+g.id+"], [umi\\:object-id="+g.id+"]").remove();uAdmin.eip.normalizeBoxes();g=false;uAdmin.eip.normalizeBoxes();d.text(parseInt(d.text())+1);--c.save.count;c.save("del")}},"json")}else{c.save.add={};c.save.added={};c.save.move={};c.save.edit={};c.save.del={};c.save.custom={};c.setSaveStatus(false);uAdmin.eip.message(getLabel("js-panel-message-changes-saved"));jQuery("input:button",c.progress).removeClass("hidden");uAdmin.eip.onSave("after")}break;default:uAdmin.eip.onSave("before");while(0<=this.current){if(c[0].add){c.save.add[c[0].id]=c[0];++c.save.count}else{if(this[0].move){if(c.save.move[c[0].moved]){delete c.save.move[c[0].moved];--c.save.count}c.save.move[c[0].moved]=c[0];++c.save.count}else{if(this[0]["delete"]){c.save.del[c[0].id]=c[0];++c.save.count}else{if(this[0]["custom"]){c.save.custom[c[0].id]=c[0];++c.save.count}else{if(c.save.edit[c[0].id+"_"+c[0].field_name]){c.save.edit[c[0].id+"_"+c[0].field_name].new_value=c[0].new_value}else{c.save.edit[c[0].id+"_"+c[0].field_name]=c[0];++c.save.count}}}}}c.shift();--c.current}c.progress=jQuery.openPopupLayer({name:"SaveProgress",width:400,height:200,data:'\n						<div class="eip_win_head popupHeader">\n							<div class="eip_win_close popupClose hidden">&#160;</div>\n							<div class="eip_win_title">'+getLabel("js-cms-eip-edit_in_place-save_processing")+'</div>\n						</div>\n						<div class="eip_win_body popupBody">\n							<div class="popupText">'+getLabel("js-cms-eip-edit_in_place-saved_count_modify",c.save.count)+'</div>\n							<div class="eip_buttons">\n								<input type="button" class="primary ok hidden" value="OK" />\n								<div style="clear: both;" />\n							</div>\n						</div>\n					'}).find("#popupLayer_SaveProgress");jQuery("input:button",c.progress).click(function(){jQuery.closePopupLayer("SaveProgress")});c.save("add")}return false};a.prototype.queue.save.add={};a.prototype.queue.save.added={};a.prototype.queue.save.move={};a.prototype.queue.save.edit={};a.prototype.queue.save.del={};a.prototype.queue.save.custom={};a.prototype.queue.save.count=0;a.prototype.queue.current=-1;a.prototype.enabled=false;a.prototype.previousEditBox=null;a.prototype.editNodes=[];a.prototype.listNodes=[];a.prototype.meta={};return b(a,this)});uAdmin(".editor",function(b){function a(){}a.prototype.get=function(d,c){var e=uAdmin.eip.searchAttr(d);if(e){this.info=e;this.files=c;return this.load()}return false};a.prototype.load=function(){var m=this,f,d,g,l,k,j=uAdmin.eip.queue.search(m.info);if(j){if(j.add){if(m.info.field_name=="name"){m.info.field_type="string"}else{if(jQuery(m.info.node).attr("umi:field-type")){m.info.field_type=jQuery(m.info.node).attr("umi:field-type")}else{f=jQuery.ajax({url:"/utype/"+j.type_id+".json",async:false,dataType:"json"});f=JSON.parse(f.responseText);for(l in f.type.fieldgroups.group){l=f.type.fieldgroups.group[l];for(k in l.field){k=l.field[k];if(k.name==m.info.field_name){m.info.field_type=k.type["data-type"];break}}if(m.info.field_type){break}}}}m.info.old_value=jQuery(m.info.node).attr("umi:empty");return m.draw(m.info.field_type)}m.info.old_value=j.new_value;m.info.field_type=j.field_type;m.info.params=j.params;m.info.node=j.node;if(m.info.field_type=="relation"){m.info.guide_id=j.guide_id;m.info.multiple=j.multiple;m.info["public"]=j["public"]}return m.draw(j.field_type)}var c=jQuery(m.info.node),h=c.attr("umi:field-type");if(h&&h!="relation"&&h!="symlink"){m.info.field_type=h;if(m.info.node.tagName=="IMG"){m.info.old_value={src:c.attr("src")}}else{m.info.old_value=(c.attr("umi:empty")&&c.attr("umi:empty")==c.html())?"":c.html()}return m.draw(m.info.field_type)}d={};var e=jQuery(m.info.node).attr("umi:"+m.info.type+"-id");if(!e||e.match(/^new/)){e=jQuery(m.info.node).attr("umi:clone-source-id")||jQuery(m.info.node).parents("[umi\\:"+m.info.type+"-id]").first().attr("umi:clone-source-id")||m.info.id}d[m.info.type+"-id"]=e;d["field-name"]=m.info.field_name;d.qt=new Date().getTime();f=jQuery.ajax({url:"/admin/content/editValue/load.json",async:false,data:d,type:"POST",dataType:"json"});f=JSON.parse(f.responseText);if(f.error){uAdmin.eip.message(f.error);return false}if(f.user&&f.user.type=="guest"){uAdmin.eip.message(getLabel("error-auth-required"));uAdmin.eip.closeMessages();uAdmin.session.sessionCloseMessage(true);return false}m.info.old_value={};switch(f.property.type){case"relation":for(g in f.property.item){m.info.old_value[f.property.item[g].id]=f.property.item[g].name}m.info.guide_id=f.property["guide-id"];m.info.multiple=(f.property.multiple=="multiple");m.info["public"]=(f.property["public"]=="public");break;case"symlink":for(g in f.property.page){m.info.old_value[f.property.page[g].id]=f.property.page[g].name}break;default:m.info.old_value=f.property.value}if(jQuery(m.info.node).attr("umi:clone-source-id")||jQuery(m.info.node).parents("[umi\\:clone-source-id]").length){m.info.old_value=typeof m.info.old_value=="string"?"":[]}m.info.field_type=f.property.type;return m.draw(f.property.type)};a.prototype.bindFinishEvent=function(){var c=this;jQuery(document).on("click",function(h){if(!uAdmin.eip.enabled){return}if(jQuery(h.target).attr("contentEditable")=="true"){return}if(jQuery(h.target).attr("class")=="eip-ui-element"){return}if(jQuery(h.target).attr("class")=="ui-datepicker"){return}if(jQuery(h.target).attr("class")=="symlink-item-delete"){return}if(jQuery(h.target).parents().andSelf().hasClass("eip_win")){return true}if(jQuery(h.target).parents().andSelf().hasClass("eip-ieditor-img-wrapper")){return true}if(jQuery(h.target).parents().andSelf().filter("#mce-modal-block").length){return true}if(jQuery(h.target).parents().andSelf().filter("#popupLayerScreenLocker").length){return true}if(jQuery(h.target).parents().andSelf().filter("#jGrowl").length){return true}if(jQuery(h.target).parents(".eip-ui-element, .ui-datepicker, .ui-datepicker-title, .ui-datepicker-header, .ui-datepicker-calendar").size()){return}var d=jQuery(h.target).parents();for(var g=0;g<d.size();g++){var f=d[g];if(f.tagName=="TABLE"){continue}if(f.tagName=="BODY"){break}if(jQuery(f).attr("class")=="symlink-item-delete"){return}if(jQuery(f).attr("contentEditable")=="true"){return}if(jQuery(f).hasClass("mceMenu")){return true}if(jQuery(f).hasClass("mceEditor")){return true}if(jQuery(f).parents().andSelf().hasClass("mceColorSplitMenu")){return true}if(jQuery(f).parents().andSelf().hasClass("mceMenuItem")){return true}if(jQuery(f).parents().andSelf().hasClass("mce-panel")){return true}if(jQuery(f).parents().andSelf().hasClass("eip-ieditor-imgareaselect-wrapper")){return true}}c.finish(true)})};a.prototype.draw=function(d){var c=this;if(typeof c.draw[d]=="function"){return c.draw[d](c)}uAdmin.eip.message('Unkown field type "'+d+'"');return false};a.prototype.draw["boolean"]=function(d){a.prototype.YES_TEXT=getLabel("js-cms-eip-editor-yes");a.prototype.NO_TEXT=getLabel("js-cms-eip-editor-no");var c=uAdmin.eip.nodePositionInfo(d.info.node);if(typeof d.info.old_value!="boolean"){switch(d.info.old_value){case a.prototype.NO_TEXT:case"0":d.info.old_value=false;break;case a.prototype.YES_TEXT:case"1":d.info.old_value=true;break;default:d.info.old_value=!!d.info.old_value;break}}if(d.info.node.tagName=="INPUT"&&d.info.node.type=="checkbox"){setTimeout(function(){d.info.new_value=!d.info.old_value;d.info.node.checked=d.info.new_value;d.commit();d.cleanup()},300);return d}var e=document.createElement("input");e.type="checkbox";document.body.appendChild(e);jQuery(window).bind("resize.ns"+d.info.guide_id,function(){var f=uAdmin.eip.nodePositionInfo(d.info.node);jQuery(e).css({left:f.x,top:f.y})});d.finish=function(f){if(f){d.info.new_value=e.checked;jQuery(d.info.node).text(d.info.new_value?a.prototype.YES_TEXT:a.prototype.NO_TEXT);d.commit()}jQuery(e).remove();jQuery(window).unbind("resize.ns"+d.info.guide_id);d.info.node.style.visibility="visible";d.cleanup()};e.checked=!!d.info.old_value;jQuery(e).attr("class","eip-ui-element eip-ui-boolean");jQuery(e).css({position:"absolute",left:c.x,top:c.y,"z-index":1100});uAdmin.eip.applyStyles(d.info.node,e);d.info.node.style.visibility="hidden";jQuery(e).click(function(){d.finish(true)});return d};a.prototype.draw["int"]=function(c){return c.draw.text(c)};a.prototype.draw["float"]=function(c){return c.draw.text(c)};a.prototype.draw.counter=function(c){return c.draw.text(c)};a.prototype.draw.price=function(c){return c.draw.text(c)};a.prototype.draw.string=function(c){return c.draw.text(c)};a.prototype.draw.tags=function(c){return c.draw.text(c)};a.prototype.draw.text=function(c,k){var f=jQuery(c.info.node),g=f.html();if(!c.info.old_value){c.info.old_value=""}if(k){c.info.old_value=c.info.old_value.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}if(!(c.info.field_type=="wysiwyg"&&uAdmin.wysiwyg.settings.inline)){f[0].innerHTML=c.info.old_value||"&nbsp;";f.attr("contentEditable",true)}f.blur().focus();c.finish=function(l){c.finish=function(){};jQuery(document).unbind("keyup");jQuery(document).unbind("click");f.attr("contentEditable",false);jQuery(".u-eip-sortable").sortable("enable");if(l){if(!k&&c.info.field_type!="wysiwyg"){var n=f.html();if(n.match(/\s<br>$/g)){n=n.replace(/<br>$/g,"")}var m=n;n=n.replace(/<!--[\w\W\n]*?-->/mig,"");n=n.replace(/<style[^>]*>[\w\W\n]*?<\/style>/mig,"");n=n.replace(/<([^>]+)>/mg,"");n=n.replace(/(\t|\n)/gi," ");n=n.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){n=n.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}if(n!=m){f.html(n)}}c.info.new_value=f.html();if(c.info.new_value==" "||c.info.new_value=="&nbsp;"||c.info.new_value=="<p>&nbsp;</p>"){c.info.new_value="";f.html(c.info.new_value)}if(c.info.field_type!="wysiwyg"&&c.info.field_type!="text"){c.info.new_value=jQuery.trim(c.info.new_value);if(c.info.new_value.substr(-4,4)=="<br>"){c.info.new_value=c.info.new_value.substr(0,c.info.new_value.length-4)}}else{c.info.new_value=c.info.new_value.replace(/%[A-z0-9_]+(?:%20)+[A-z0-9_]+%28[A-z0-9%]*%29%/gi,unescape)}switch(c.info.field_type){case"int":case"float":case"price":case"counter":c.info.new_value=parseFloat(c.info.new_value);break}c.commit()}else{f.html(g)}c.cleanup()};c.bindFinishEvent();var e=f.width(),j=f.height(),h=null;jQuery(".u-eip-sortable").sortable("disable");f.focus();var d=null;jQuery(document).bind("keyup",function(l){if(e!=f.width()||j!=f.height()){e=f.width();j=f.height();if(h){clearTimeout(h)}h=setTimeout(function(){uAdmin.eip.normalizeBoxes();h=null},1000)}if(l.keyCode==46){if(d==f.html().length){if(d==1){f.html("")}}}}).bind("keydown",function(l){if(l.keyCode==46){d=f.html().length}if(l.keyCode==13&&c.info.field_type!="wysiwyg"&&c.info.field_type!="text"){c.finish(true);return false}if(l.keyCode==27){c.finish(false);return false}return true});return c};a.prototype.draw.wysiwyg=function(l){var g=jQuery(l.info.node),c=false,f=false,d=false,j=false,e=function(m){m=m.replace(/<![\s\S]*?--[ \t\n\r]*>/ig," ");m=m.replace(/<!--.*?-->/ig," ");if(jQuery.browser.mozilla){m=m.replace(/<\/?(style|font|title).*[^>]*>/ig,"")}m=m.replace(/<\/?(title|style|font|meta)\s*[^>]*>/ig,"");m=m.replace(/\s*mso-[^:]+:[^;""]+;?/ig,"");m=m.replace(/<\/?o:[^>]*\/?>/ig,"");m=m.replace(/ style=['"]?[^'"]*['"]?/ig,"");m=m.replace(/ class=['"]?[^'">]*['"]?/ig,"");m=m.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/ig," ");m=m.replace(/<span\s*[^>]*>/ig,"");m=m.replace(/<\/span\s*[^>]*>/ig,"");m=m.replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"");m=m.replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ");m=m.replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"");m=m.replace(/(\t|\n)/gi," ");m=m.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){m=m.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}return m};l.draw.text(l,true);jQuery(document).bind("keyup",function(n){if((n.keyCode==86||c)||(n.keyCode==45&&f)){if(!(tinymce&&tinymce.settings&&tinymce.settings.inline)){var m=e(g.html());if(m!=g.html()){g.html(m)}}if(c&&!n.ctrlKey){c=false}if(f&&!n.shiftKey){f=false}}switch(n.keyCode){case 16:if(!j){f=false}break;case 17:if(!d){c=false}break;case 45:j=false;break;case 86:d=false;break}}).bind("keydown",function(m){switch(m.keyCode){case 16:f=true;break;case 17:c=true;break;case 45:j=true;break;case 86:d=true;break}});var h=uAdmin.wysiwyg.init(l.info.node);var k=l.finish;l.finish=function(m){h.destroy();k(m);uAdmin.eip.bindEvents()};return l};a.prototype.draw.file=function(l,e){var c="./images/cms/data/",g="",d,h,f;l.finish=function(n){if(n){if(l.info.node.tagName=="IMG"){l.info.node.src=l.info.new_value.src}else{if(e){l.info.node.style.backgroundImage="url("+l.info.new_value.src+")"}else{l.info.node.innerText=l.info.new_value.src.substr(l.info.new_value.src.lastIndexOf("/")+1)}}l.commit();if(uAdmin&&uAdmin.eip&&uAdmin.eip.reinitEmptyLists){uAdmin.eip.reinitEmptyLists()}}l.cleanup()};if(l.info.old_value){if(l.info.old_value.src==undefined){l.info.old_value={src:l.info.old_value}}g=l.info.old_value.src.split(/\//g).pop();c="."+l.info.old_value.src.substr(0,l.info.old_value.src.length-g.length-1)}if(l.files&&l.files.length){d=l.files[0];d.folder=c;if(l.info.old_value){d.file=l.info.old_value.src}if(e){d.image=1}h=jQuery.ajax({url:"/admin/data/uploadfile/",async:false,data:d,type:"POST",dataType:"json"});h=JSON.parse(h.responseText);if(h.file.path){l.new_value=h.file.path;l.finish(true)}else{l.finish()}}else{f={folder:c,file:l.info.old_value?l.info.old_value.src:""};h=jQuery.ajax({url:"/admin/data/get_filemanager_info/",async:false,data:f,type:"POST",dataType:"json"});h=JSON.parse(h.responseText);var j="folder="+c;if(l.info.old_value){j+="&file="+l.info.old_value.src}if(e){j+="&image=1"}var k={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+j},elfinder:{height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+j+"&lang="+h.lang+"&file_hash="+h.file_hash+"&folder_hash="+h.folder_hash}};jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:k[h.filemanager].height,url:k[h.filemanager].url,afterClose:function(n){if(n){if(typeof n=="object"){n=n[0]}l.info.new_value=n?{src:n.toString()}:"";l.finish(true)}else{l.finish()}}});if(h.filemanager=="elfinder"){var m='<div id="watermark_wrapper"><label for="add_watermark">';m+=getLabel("js-water-mark");m+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';m+='<label for="remember_last_folder">';m+=getLabel("js-remember-last-dir");m+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(jQuery.cookie("remember_last_folder")){m+='checked="checked"'}m+="/></div>";jQuery("#popupLayer_Filemanager .popupBody").append(m)}}return l};a.prototype.draw.img_file=function(c){return c.draw.file(c,true)};a.prototype.draw.video_file=function(c){return c.draw.file(c)};a.prototype.draw.date=function(d){if(d.info.old_value==jQuery(d.info.node).attr("umi:empty")){d.info.old_value=null}var e=d.info.old_value;Date.prototype.getFormattedDate=function(j){var p=function(q){return(q>=10)?q:"0"+q};var m=this.getFullYear();var k=p(this.getMonth()+1);var n=p(this.getDate());var o=p(this.getHours());var h=p(this.getMinutes());var g=/NaN/;if(j){if((g.exec(m)!=null)||(g.exec(k)!=null)||(g.exec(n)!=null)||(g.exec(o)!=null)||(g.exec(h)!=null)){var l=new Date();return p(l.getDate())+"."+p(l.getMonth()+1)+"."+l.getFullYear()+" "+p(l.getHours())+":"+p(l.getMinutes())}return m+"-"+k+"-"+n+" "+o+":"+h}else{if((g.exec(o)!=null)||(g.exec(h)!=null)){var l=new Date();return p(l.getHours())+":"+p(l.getMinutes())}return o+":"+h}};if(e){if(e.match(/\d{4}-/g)){e=new Date(e.replace(/(\d{4})-(\d{2})-(\d{2})\s(\d{2}):(\d{2})/g,"$2 $3 $1 $4:$5"))}else{e=new Date(e.replace(/(\d{2})\.(\d{2})\.(\d{4})\s(\d{2}):(\d{2})/g,"$2 $1 $3 $4:$5"))}}if(!e){e=new Date}if(d.info.old_value){d.info.old_value=e.getFormattedDate(true)}d.draw.text(d);var c=uAdmin.eip.nodePositionInfo(d.info.node);var f=jQuery("#u-datepicker-input");if(!f.size()){f=document.createElement("input");f.id="u-datepicker-input";document.body.appendChild(f)}jQuery(window).bind("resize.ns"+d.info.guide_id,function(){var g=uAdmin.eip.nodePositionInfo(d.info.node);jQuery(".ui-datepicker-trigger").css({left:g.x+g.width+5,top:g.y});jQuery(f).css({left:(g.x+g.width+5),top:g.y})});d.finish=function(g){jQuery(window).unbind("resize.ns"+d.info.guide_id);jQuery(f).datepicker("destroy");jQuery(".ui-datepicker-trigger").remove();if(!d.info.new_value){d.info.new_value=jQuery(d.info.node).html()}d.cleanup();d.commit()};jQuery(f).css({position:"absolute",left:(c.x+c.width+5),top:(c.y),width:"1",height:"1",visibility:"hidden","font-size":"62.5%","z-index":560});jQuery(f).datepicker(jQuery.extend({showOn:"button",buttonImage:"/styles/common/other/calendar/icons_calendar_buttrefly_eip.png",buttonImageOnly:true,dateFormat:"yy-mm-dd",defaultDate:e,onSelect:function(g){d.info.new_value=g+" "+e.getFormattedDate(false);jQuery(d.info.node).html(d.info.new_value);jQuery(d.info.node).focus()}},jQuery.datepicker.regional[uAdmin.data.lang]));jQuery(d.info.node).html(d.info.old_value||e.getFormattedDate(true));uAdmin.eip.placeWith(d.info.node,jQuery(".ui-datepicker-trigger"),"right","middle");if(d.id==""){d.info.old_value=""}jQuery(".ui-datepicker-trigger").css({left:c.x+c.width+5,top:c.y});return d};a.prototype.draw.relation=function(m){jQuery(document).one("mouseup",function(){setTimeout(function(){m.bindFinishEvent()},100)});setTimeout(function(){jQuery(document).die("mouseup");m.bindFinishEvent()},1000);var f=uAdmin.eip.nodePositionInfo(m.info.node);var l=document.createElement("select");var k=document.createElement("input");document.body.appendChild(l);if(m.info.guide_id&&m.info["public"]){var g=document.createElement("input");g.type="button";g.value=" ";g.id="relationButton"+m.info.guide_id;g.className="relationAddButton";document.body.appendChild(g)}jQuery(l).attr("class","eip-ui-element");jQuery(l).css({position:"absolute",left:f.x,top:f.y,"z-index":1100});uAdmin.eip.applyStyles(m.info.node,l);jQuery(m.info.node).css("visibility","hidden");if(m.info.multiple){jQuery(l).attr("multiple","multiple");jQuery(l).attr("size",3)}var d;for(d in m.info.old_value){var e=document.createElement("option");jQuery(e).attr("value",d);jQuery(e).attr("selected","selected");jQuery(e).html(m.info.old_value[d]);l.appendChild(e)}jQuery(l).focus();jQuery(l).attr("name","rel_input");jQuery(l).attr("id","relationSelect"+m.info.guide_id);document.body.appendChild(k);uAdmin.eip.applyStyles(m.info.node,k);jQuery(k).attr({id:"relationInput"+m.info.guide_id,"class":"eip-ui-element",name:"rel_input_new"});if(typeof relationControl=="undefined"){jQuery('<script src="/styles/common/js/relation.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var c=new relationControl(m.info.guide_id,null,true,"/admin/data/guide_items_all/");jQuery(window).bind("resize.ns"+m.info.guide_id,function(){var n=uAdmin.eip.nodePositionInfo(m.info.node);jQuery(l).css({left:n.x,top:n.y});jQuery(k).css({left:n.x,top:(n.y+jQuery(l).height()+5)});jQuery(g).css({left:(n.x+jQuery(k).width()+5),top:(n.y+jQuery(l).height()+Math.round((jQuery(k).height()-jQuery(g).height())/2))})});m.finish=function(){var o=[];m.info.new_value=c.getValue();m.commit();for(var n in m.info.new_value){o.push(m.info.new_value[n])}m.info.node.innerHTML=o.join(", ");m.info.node.style.visibility="visible";jQuery(l).resizable("destroy");jQuery(l).remove();jQuery(k).remove();jQuery(g).remove();jQuery("#u-ep-search-trigger").remove();jQuery(window).unbind("resize.ns"+m.info.guide_id);m.cleanup()};c.loadItemsAll();if(m.info.multiple){var j=jQuery(l).height(),h=350;if(j<150){j=75;jQuery(l).css("height",j)}jQuery(l).resizable({minWidth:jQuery(l).width(),maxWidth:jQuery(l).width(),minHeight:j,maxHeight:h});jQuery(".ui-wrapper").css("z-index","1100")}jQuery(k).css({position:"absolute",width:jQuery(l).width(),left:f.x,top:(f.y+jQuery(l).height()+5),"z-index":1111});jQuery(g).css({position:"absolute",left:(f.x+jQuery(k).width()+5),top:(f.y+jQuery(l).height()+Math.round((jQuery(k).height()-jQuery(g).height())/2)),"z-index":1112});return m};a.prototype.draw.symlink=function(e){jQuery(document).one("mouseup",function(){setTimeout(function(){e.bindFinishEvent()},100)});setTimeout(function(){jQuery(document).die("mouseup");e.bindFinishEvent()},1000);var d=jQuery(e.info.node).attr("umi:type")?jQuery(e.info.node).attr("umi:type").split("::"):[];var c=uAdmin.eip.nodePositionInfo(e.info.node);var h=jQuery('<div><div id="symlinkInput'+e.info.id+'" /></div>').attr({"class":"eip-ui-element"}).css({position:"absolute",left:c.x,top:c.y,"z-index":1100}).appendTo("body");if(typeof symlinkControl=="undefined"){jQuery('<script src="/styles/common/js/symlink.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")}var g=new symlinkControl(e.info.id,(d[0]||null),d,{inputName:e.info.field_name+"[]",fadeColorStart:[255,255,225],fadeColorEnd:[255,255,255]});for(var f in e.info.old_value){g.addItem(f,e.info.old_value[f],d,"")}uAdmin.eip.applyStyles(e.info.node,h[0]);jQuery("div input:text",h).css({width:h.width()-20});jQuery("div img.treeButton",h).css({bottom:"-4px","margin-left":"2px",position:"relative","background-color":"white",cursor:"pointer"});jQuery(e.info.node).css("visibility","hidden");jQuery(window).bind("resize.ns"+e.info.guide_id,function(){var j=uAdmin.eip.nodePositionInfo(e.info.node);jQuery(h).css({left:j.x,top:j.y})});e.finish=function(){var j=jQuery('input[name="'+e.info.field_name+'[]"]'),k=[];jQuery(e.info.node).css("visibility","visible");e.info.new_value={};for(f=0;f<j.length;f++){if(j[f].value){e.info.new_value[j[f].value]=jQuery("ul li span",h)[f-1].innerHTML;k.push(e.info.new_value[j[f].value])}}e.info.node.innerHTML=k.join(", ");e.commit();h.resizable("destroy");h.remove();jQuery("div.symlinkAutosuggest").remove();jQuery("#u-ep-search-trigger").remove();jQuery(window).unbind("resize.ns"+e.info.guide_id);e.cleanup()};g.loadItems();return e};a.prototype.replace=function(e,d,c){return e?this.replace[e.field_type](e,d,c):false};a.prototype.replace.img_file=function(f,q,o){var l=false,g=jQuery(f.node),m,k,j;var e=function(u,t){return u==t};var d=function(t){if(t.indexOf("/images/cms/thumbs/")>=0){return true}if(t.indexOf("/images/autothumbs/")>=0){return true}return false};var s=function(z,x,t){z=z.toString();var v=z.split(/\./g);if(v.length<2){return false}var w=v[v.length-1].toString();v=v[v.length-2].toString().split(/\//g);var u=v[v.length-1].toString();var y=z.substr(0,z.length-u.length-w.length-1);return"/images/autothumbs"+y+u+"_"+x+"_"+t+"."+w};if(f.node.tagName=="IMG"){if(e(g.attr("src"),o.src||"")){f.node.src=q.src||"";l=true}else{if(d(f.node.src)){var c=g.width();var r=g.height();var p=f.node.src;if(p.indexOf(c)!=-1&&p.indexOf(r)==-1){r="auto"}if(p.indexOf(c)==-1&&p.indexOf(r)!=-1){c="auto"}f.node.src=s(q.src,c,r);l=true}}g.one("load",function(){uAdmin.eip.normalizeBoxes()})}var n=f.node.style.backgroundImage.replace(/"/g,"");if(n.substr(0,4)!="url("){if(!l&&g.attr("childNodes")){m=g.attr("childNodes");for(j=0;j<m.length;j++){k=m.item(j);if(k&&jQuery(k).attr("tagName")){replaceImage(jQuery(k),q.src,o.src)}}}return l}n=n.substring(4,n.length-1);var h=window.location.protocol+"//"+window.location.host;if(n.substr(0,h.length)==h){n=n.substr(h.length)}if(!n){return l}if(e(n,o.src)){f.node.style.backgroundImage="url("+q.src+")";l=true}if(!l&&g.attr("childNodes")){m=g.attr("childNodes");for(j=0;j<m.length;j++){k=m.item(j);if(k&&jQuery(k).attr("tagName")){replaceImage(jQuery(k),q.src,o.src)}}}return l};a.prototype.replace.video_file=function(f,d,c){var e=function(g){return(navigator.appName.indexOf("Microsoft")!=-1)?window[g]:document[g]};e("UmiVideoPlayer").setVideoFile(d);return true};a.prototype.replace["boolean"]=function(e,d,c){if(e.node.tagName=="INPUT"&&e.node.type=="checkbox"){e.node.checked=d?true:false}else{jQuery(e.node).html(d?getLabel("js-cms-eip-editor-yes"):getLabel("js-cms-eip-editor-no"))}return true};a.prototype.replace.relation=function(g,f,c){var e=[],d;for(d in f){e.push(f[d])}jQuery(g.node).html(e.join(", "));return true};a.prototype.replace.symlink=function(g,f,c){var e="",d;for(d in f){e+="<span>"+f[d]+"</span><br />"}jQuery(g.node).html(e);return true};a.prototype.replace["int"]=function(e,d,c){return this.text(e,d,c)};a.prototype.replace["float"]=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.counter=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.price=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.string=function(e,d,c){return jQuery(e.node).html(d)};a.prototype.replace.tags=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.text=function(e,d,c){return jQuery(e.node).html(d)};a.prototype.replace.wysiwyg=function(e,d,c){return jQuery(e.node).html(d||"&nbsp;")};a.prototype.replace.file=function(e,d,c){return this.text(e,d,c)};a.prototype.replace.date=function(e,d,c){return this.text(e,d,c)};a.prototype.commit=function(){uAdmin.eip.trigger("ActiveEditorCommit","before");var d=this.info.new_value,c=this.info.old_value;if(this.info.field_type.match(/file/)){d=this.info.new_value.src;c=this.info.old_value?this.info.old_value.src:""}if(!this.equals(d,c)){jQuery(this.info.node).addClass("u-eip-modified");uAdmin.eip.queue.add(this.info)}else{if(uAdmin.eip.queue.search(this.info)){jQuery(this.info.node).addClass("u-eip-modified")}}uAdmin.eip.trigger("ActiveEditorCommit","after")};a.prototype.cleanup=function(){uAdmin.eip.bindEvents();this.finish=function(){this.cleanup()};uAdmin.eip.highlightNode(this.info.node);jQuery(".u-eip-add-button").css("display","block");uAdmin.eip.normalizeBoxes();this.info.node.blur();jQuery(this.info.node).removeClass("u-eip-editing")};a.prototype.finish=function(){this.cleanup()};a.prototype.equals=function(){var d=false,c=arguments,g=Object.prototype.toString,f,e={length:0};switch(true){case (c.length!==2):break;case (typeof c[0]!==typeof c[1]):break;case (g.call(c[0])!==g.call(c[1])):break;default:switch(typeof c[0]){case"undefined":break;case"object":if(g.call(c[0])=="[object Array]"){d=(c[0].length===c[1].length);if(d){for(f=0;f<c[0].length;f++){e[c[0][f]]=f;++e.length}for(f=0;f<c[1].length;f++){if(delete e[c[0][f]]){--e.length}}if(e.length===0){d=true}}}else{for(f in c[0]){e[f]=f;++e.length}for(f in c[1]){if(delete e[f]){--e.length}}if(e.length===0){d=true}if(d){for(f in c[0]){d=this.equals(c[0][f],c[1][f]);if(!d){break}}}}break;default:d=(c[0]===c[1])}}return d};return b(a,this)},"eip");uAdmin(".ieditor",function(r){var s={backend_request_url:"/udata/content/ieditor/",backend_request_method:"POST",image_data_url:"/udata/content/getImageData.json",image_data_request_method:"POST",coockie_name:"eip_ieditor_state",preloader_src:"/images/cms/eip/loader.gif",preloader_holder_css_class:"eip-ieditor-preloader",collection:{editor_id_attribute:"data-ieditor-id"},editor:{menu_wrapper_css_class:"eip-ieditor-menu-wrapper",img_wrapper_css_class:"eip-ieditor-img-wrapper",animation_speed:100},layout:{extended:{css_class:"eip-ieditor-layout-extended",right_margin:"5px",bottom_margin:"5px"},simple:{css_class:"eip-ieditor-layout-simple",right_margin:"5px",bottom_margin:"5px"},bubble:{css_class:"eip-ieditor-layout-bubble",arrow_css_class:"eip-ieditor-layout-bubble-arrow",bottom_margin:-40,bottom_margin_delta:15},big_img_min_width:300,big_img_min_height:350,small_img_max_width:150,small_img_max_height:150},module:{module_css_class:"eip-ieditor-module",icon_holder_css_class:"eip-ieditor-module-icon",title_holder_css_class:"eip-ieditor-module-title",upload_module:{url:"/udata/content/ieditor/upload.json",iframe_name:"eip-ieditor-upload-iframe",file_input_name:"eip-ieditor-upload-fileinput[]",css_class:"eip-ieditor-module-upload"},filemanager_module:{css_class:"eip-ieditor-module-filemanager"},edit_module:{css_class:"eip-ieditor-module-edit"},crop_module:{css_class:"eip-ieditor-module-crop"},resize_module:{css_class:"eip-ieditor-module-resize"},rotate_module:{css_class:"eip-ieditor-module-rotate"},popup_module:{css_class:"eip-ieditor-module-popup",fancybox_css_class:"fancybox-group",wrapper_css_class:"eip-ieditor-module-popup-wrapper",thumb_width:100},delete_module:{css_class:"eip-ieditor-module-delete"},apply_module:{css_class:"eip-ieditor-module-apply"},cancel_module:{css_class:"eip-ieditor-module-cancel"}},img_area_select:{css_class:"eip-ieditor-imgareaselect-wrapper",plugin_options:{parent:null,hide:true,handles:true,instance:true,keys:true,movable:true,persistent:true,resizeMargin:10,zIndex:100001,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}}},filemanager:{url:"/styles/common/other/elfinder/umifilebrowser.html?lang=ru",window_width:660,window_height:530},browser_modules:{msie:[u,q,b,d,h,n,a],mozilla:[u,j,q,b,c,w,d,h,n,a],opera:[u,j,q,b,c,w,d,h,n,a],webkit:[u,j,q,b,c,w,d,h,n,a]}};uAdmin.inherit=function(z,y){var A=function(){};A.prototype=y.prototype;z.prototype=new A();z.prototype.constructor=z;z.superclass=y.prototype};var g=function(){if(!uAdmin||!uAdmin.eip){throw"Edit-in-place is not initialized"}this.COOKIE_NAME=s.coockie_name;this.COOKIE_ENABLED_VALUE="enabled";this.COOKIE_DISABLED_VALUE="disabled";this.jqToggleButton=null;this.bEnabled=true;var y=this;uAdmin.eip.bind("Enable",function(z){if(z=="after"){y.addPanelButton()}});uAdmin.eip.bind("Disable",function(z){if(z=="after"){y.removePanelButton();y.disable()}});uAdmin.eip.bind("ActiveEditorCommit",function(z){if(z=="before"&&uAdmin.eip.editor.info.field_type=="wysiwyg"&&uAdmin.eip.editor.info.old_value&&uAdmin.eip.editor.info.new_value){uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"");uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"");uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/(src=".*)\?[0-9]+/gi,"$1");uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/(src=".*)\?[0-9]+/gi,"$1")}else{uAdmin.eip.normalizeBoxes()}});uAdmin.eip.bind("AddPhotoToAlbum",function(C,A){if(C=="after"&&A&&A.newNode&&A.newNode.length){var B=x.getInstance().EDITOR_ID_ATTRIBUTE;A.newNode.find("img["+B+"]").andSelf().removeAttr(B);if(!uAdmin.ieditor.isEnabled()){return}var D=A.newNode.find("img")[0],z=jQuery(D),E=x.getInstance().initEditor(D);if(E instanceof o){z.on("load",function(){E.init(z,z.attr(B));E.setEditMode()})}}});uAdmin.onLoad("wysiwyg",function(){tinymce.on("AddEditor",function(z){z.editor.on("SetAttrib",function(A){jQuery(A.attrElm).on("load",function(B){if(!uAdmin.ieditor.isEnabled()){return}var C=x.getInstance().initEditor(this);if(C.getEditState()){return}C.destroy(true);C.setEditState(true);C.init(jQuery(this),jQuery(this).attr(x.getInstance().EDITOR_ID_ATTRIBUTE));window.setTimeout(function(){tinymce.activeEditor.selection.collapse()},0)})});z.editor.on("init",function(A){var B=this.dom.select("img:not(.mce-object)");if(uAdmin.ieditor.isEnabled()&&B&&B.length){uAdmin.ieditor.enable(B)}})})});jQuery("body").on("click",function(A){if(jQuery(A.target).closest("."+s.collection.editor_id_attribute+", ."+s.img_area_select.css_class).length){return}if(jQuery(A.target).is(".mce-resizehandle, img")){return}var B=x.getInstance().getActiveEditor();if(B instanceof o===false){return}var z=B.getEnabledModule();z.cancel();z.deactivate();B.setEditState(false);B.hide();B.switchOn();B.redrawMenu();B.drawDeleteButton()});if(uAdmin.eip.enabled){this.addPanelButton()}};g.prototype.isEnabled=function(){return this.bEnabled};g.getNodes=function(y){var z=jQuery("img").filter(function(){return jQuery(this).is("[umi\\:field-name]")||jQuery(this).parents(".mceEditor").length||jQuery(this).parents("[umi\\:field-type='wysiwyg']").length});return y?z:z.toArray()};g.prototype.getNodes=function(y){return g.getNodes(y)};g.prototype.enable=function(B){if(!uAdmin.eip.enabled){return}if(!B){B=this.getNodes()}var y=x.getInstance(),A=y.getActiveEditor();for(var z=0;z<B.length;z++){if(y.getEditorByNode(B[z])){if(!A||A.jqImgNode[0]!==B[z]){y.getEditorByNode(B[z]).destroy();y.initEditor(B[z])}}else{y.initEditor(B[z])}}this.removeEipDeleteButtons();this.bEnabled=true;this.jqToggleButton.addClass("act")};g.prototype.disable=function(){if(!this.isEnabled()){return}var y=x.getInstance().getActiveEditor();if(y instanceof o){y.getEnabledModule()&&y.getEnabledModule().cancel()}x.getInstance().removeAllEditors();x.getInstance().turnOffEditMode();this.addEipDeleteButtons();this.bEnabled=false;this.jqToggleButton.removeClass("act")};g.prototype.reinit=function(){x.getInstance().reinitActiveEditors()};g.prototype.setSettings=function(z){var y=function(B,C){for(var A in B){if(!B.hasOwnProperty(A)||!C.hasOwnProperty(A)){continue}if(typeof B[A]==="object"&&B[A] instanceof Object){y(B[A],C[A])}else{C[A]=B[A]}}};y(z,s);x.getInstance().reinitActiveEditors()};g.prototype.getEditorsCollection=function(){return x.getInstance()};g.prototype.removeEipDeleteButtons=function(){this.jqEipDeleteButtonsNodes=this.getNodes(true);if(!this.jqEipDeleteButtonsNodes.length){return}var y=this.jqEipDeleteButtonsNodes.parents("[umi\\:delete]").filter(function(z,A){return !!jQuery(this).parents("[umi\\:module='photoalbum']").length});this.jqEipDeleteButtonsNodes=this.jqEipDeleteButtonsNodes.filter("[umi\\:delete]").add(y);this.jqEipDeleteButtonsNodes.removeAttr("umi:delete");uAdmin.eip.dropDeleteButtons()};g.prototype.addEipDeleteButtons=function(){if(!this.jqEipDeleteButtonsNodes||!this.jqEipDeleteButtonsNodes.length){return}this.jqEipDeleteButtonsNodes.attr("umi:delete","delete");uAdmin.eip.dropDeleteButtons()};g.prototype.addPanelButton=function(){var y=this;this.jqToggleButton=jQuery("<div/>");this.jqToggleButton.attr("id","ieditor-switcher").text(getLabel("js-ieditor-switcher")).appendTo(uAdmin.panel.quickpanel).on("click",function(){if(y.isEnabled()){y.disable()}else{y.enable()}y.saveStateToCockie()});jQuery('<span class="in_ico_bg">').prependTo(this.jqToggleButton);this.applyStateFromCookie()};g.prototype.removePanelButton=function(){this.jqToggleButton&&this.jqToggleButton.length&&this.jqToggleButton.remove()};g.prototype.applyStateFromCookie=function(){if(!jQuery.cookie){return}if(jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_ENABLED_VALUE){this.enable()}else{if(jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_DISABLED_VALUE){this.disable()}else{this.enable()}}};g.prototype.saveStateToCockie=function(){if(!jQuery.cookie){return}var z=this.isEnabled()?this.COOKIE_ENABLED_VALUE:this.COOKIE_DISABLED_VALUE,y=new Date();y.setTime(y.getTime()+(3*24*60*60*1000));jQuery.cookie(this.COOKIE_NAME,z,{path:"/",expires:y})};var e=function(){this.oEventHandlers={}};e.prototype.bindEvent=function(y,z){if(typeof z!="function"){return false}if(!this.oEventHandlers[y]){this.oEventHandlers[y]=[]}this.oEventHandlers[y].push({context:this,handler:z});return true};e.prototype.triggerEvent=function(B,y){var A=this._getHandlersForObjectEvent(B,this);if(!A||!A.length){return false}for(var z=0;z<A.length;z++){A[z].apply(this,y)}return true};e.prototype._getHandlersForObjectEvent=function(C,A){var y=this.oEventHandlers[C];if(!y){return[]}var B=[];for(var z in y){if(y.hasOwnProperty(z)&&y[z].context===A&&typeof y[z].handler=="function"){B.push(y[z].handler)}}return B};var x=function(){this.settings=s;this.EDITOR_ID_ATTRIBUTE=s.collection.editor_id_attribute;this.BIG_IMG_MIN_WIDTH=s.collection.big_img_min_width;this.BIG_IMG_MIN_HEIGHT=s.collection.big_img_min_height;this.SMALL_IMG_MAX_WIDTH=s.collection.small_img_max_width;this.SMALL_IMG_MAX_HEIGHT=s.collection.small_img_max_height;this._arEditors={};this.oActiveEditor=null;this.bEditMode=false;jQuery("body").on("mouseenter","img",function(A){if(!uAdmin.eip.enabled||!uAdmin.ieditor.isEnabled()){return false}if(x.getInstance().isInEditState()){return false}var y=jQuery(this),z=x.getInstance().EDITOR_ID_ATTRIBUTE;if(!y.attr(z)){return false}var B=x.getInstance().initEditor(this);B.init(y,y.attr(z));B.show();window.setTimeout(function(){if(!B.isImageInFocus()){B.hide(function(){B.destroy(true)})}},100);return true}).on("mousemove",function(y){window.mouseX=y.pageX||y.clientX+jQuery(document).scrollLeft();window.mouseY=y.pageY||y.clientY+jQuery(document).scrollTop()})};x._instance=null;x.getInstance=function(){if(!x._instance){x._instance=new x()}return x._instance};x.cleanupHtml=function(y){return new o.cleanupHtml(y)};x.prototype.initEditor=function(A){if(x.getInstance().isInEditState()){return new t()}if(this.getEditorByNode(A)){return this.getEditorByNode(A)}var y=jQuery(A),z=this.getUniqueId();y.attr(this.EDITOR_ID_ATTRIBUTE,z);var B=new f();this._arEditors[z]=B;return B};x.prototype.reinitActiveEditors=function(){var z=[];for(var y in this._arEditors){if(!this._arEditors.hasOwnProperty(y)||this._arEditors[y] instanceof o===false){continue}z.push(this._arEditors[y].jqImgNode[0])}this.removeAllEditors();for(y=0;y<z.length;y++){this.initEditor(z[y])}};x.prototype.updateEditorsByNodes=function(y){jQuery("img",y).filter(function(){return !!jQuery(this).attr(x.getInstance().EDITOR_ID_ATTRIBUTE)}).each(function(z,A){var B=x.getInstance().initEditor(A);B.reinit()})};x.prototype.repositionActiveEditors=function(){for(var y in this._arEditors){if(!this._arEditors.hasOwnProperty(y)||this._arEditors[y] instanceof o===false){continue}if(!this._arEditors[y].jqImgNode||!this._arEditors[y].jqImgNode.length||!this._arEditors[y].jqImgNode.is(":visible")){this._arEditors[y].destroy();continue}this._arEditors[y].reinit()}};x.prototype.getEditorByNode=function(y){return this._arEditors[jQuery(y).attr(this.EDITOR_ID_ATTRIBUTE)]};x.prototype.getEditorByEditorId=function(y){return this._arEditors[y]};x.prototype.getAllEditors=function(){return this._arEditors};x.prototype.findEditors=function(B){var y=jQuery("img["+this.EDITOR_ID_ATTRIBUTE+"]",B),A=[],z=this;y.each(function(C,D){A.push(z.getEditorByNode(D))});return A};x.prototype.removeAllEditors=function(){for(var y in this._arEditors){if(!this._arEditors.hasOwnProperty(y)){continue}this.removeEditor(y)}this._arEditors={}};x.prototype.removeEditor=function(y){this._arEditors[y].destroy();delete this._arEditors[y]};x.prototype.removeEmptyEditors=function(){var y=this.getAllEditors();for(var z in y){if(!y.hasOwnProperty(z)){continue}var A=y[z];if(A instanceof o===false){continue}if(!A.getEditorId()){continue}if(!A.jqImgNode||!A.jqImgNode.length||!A.jqImgNode.is(":visible")){this.removeEditor(A.getEditorId())}}};x.prototype.getUniqueId=function(){var y="";do{y=new Date().getTime()+"_"+Math.random()}while(y in this._arEditors);return y};x.prototype.setActiveEditor=function(y){if(this.oActiveEditor&&this.oActiveEditor.deactivateEnabledModule){if(this.oActiveEditor.deactivateEnabledModule(true)){this.oActiveEditor=y;return true}else{return false}}else{this.oActiveEditor=y;return true}};x.prototype.getActiveEditor=function(){return this.oActiveEditor};x.prototype.deactivateActiveEditor=function(){return this.setActiveEditor(null)};x.prototype.turnOnEditMode=function(){this.bEditMode=true};x.prototype.turnOffEditMode=function(){this.bEditMode=false};x.prototype.isInEditState=function(){return this.bEditMode};x.prototype.each=function(A){if(typeof A!="function"){return}for(var y=0;y<this._arEditors;y++){var z=this._arEditors[y];if(z instanceof o===false){continue}A.call(z,y,z)}};var m=function(y){m.superclass.constructor.call(this);this.CSS_CLASS_NAME="";this.ANIMATIONS_SPEED=s.editor.animation_speed;this.oEditor=y};uAdmin.inherit(m,e);m.prototype.init=function(){this.oEditor.jqMenuWrapper.addClass(this.CSS_CLASS_NAME);this.reposition()};m.prototype.remove=function(){this.oEditor.jqMenuWrapper.removeClass(this.CSS_CLASS_NAME);this.resetPosition();this.oEditor.layout=null};m.prototype.reposition=function(){};m.prototype.resetPosition=function(){var y=this.oEditor.jqMenuWrapper[0];y.style.top="";y.style.bottom="";y.style.left="";y.style.right=""};m.prototype.show=function(){var y=this;this.oEditor.jqMenuWrapper.stop(true,true).fadeIn(this.ANIMATIONS_SPEED,function(){y.oEditor.triggerEvent("onShow")})};m.prototype.hide=function(z){var y=this;this.oEditor.jqMenuWrapper.add().stop(true,true).fadeOut(this.ANIMATIONS_SPEED,function(){if(typeof z=="function"){z()}y.oEditor.triggerEvent("onHide")})};var k=function(y){k.superclass.constructor.call(this,y);this.CSS_CLASS_NAME=s.layout.extended.css_class;this.init()};uAdmin.inherit(k,m);k.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:s.layout.extended.right_margin,bottom:s.layout.extended.bottom_margin})};var v=function(y){v.superclass.constructor.call(this,y);this.CSS_CLASS_NAME=s.layout.simple.css_class;this.init()};uAdmin.inherit(v,m);v.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:s.layout.simple.right_margin,bottom:s.layout.simple.bottom_margin})};var p=function(y){p.superclass.constructor.call(this,y);this.CSS_CLASS_NAME=s.layout.bubble.css_class;this.BUBBLE_ARROW_CSS_CLASS=s.layout.bubble.arrow_css_class;this.init()};uAdmin.inherit(p,m);p.prototype.init=function(){p.superclass.init.call(this);this.oEditor.jqMenuWrapper.prepend("<div class='"+this.BUBBLE_ARROW_CSS_CLASS+"'/>")};p.prototype.remove=function(){this.oEditor.jqMenuWrapper.find("."+this.BUBBLE_ARROW_CSS_CLASS).remove();p.superclass.remove.call(this)};p.prototype.reposition=function(){var y=this.oEditor.jqMenuWrapper.clone().css("left",-10000).appendTo("body").show();var z=(this.oEditor.jqImgWrapper.outerWidth()-y.outerWidth())/2;y.remove();this.oEditor.jqMenuWrapper.css({left:z+"px",bottom:s.layout.bubble.bottom_margin-s.layout.bubble.bottom_margin_delta+"px"})};p.prototype.show=function(){var y=this;this.oEditor.jqMenuWrapper.stop(true,true).fadeIn(this.ANIMATIONS_SPEED).animate({bottom:s.layout.bubble.bottom_margin+"px"},this.ANIMATIONS_SPEED,function(){y.oEditor.triggerEvent("onShow")})};p.prototype.hide=function(z){var y=this;this.oEditor.jqMenuWrapper.stop(true,true).animate({bottom:s.layout.bubble.bottom_margin-s.layout.bubble.bottom_margin_delta+"px"},this.ANIMATIONS_SPEED).fadeOut(this.ANIMATIONS_SPEED,function(){if(typeof z=="function"){z()}y.oEditor.triggerEvent("onHide")})};var o=function(){o.superclass.constructor.call(this);this.MENU_WRAPPER_CLASS_NAME=s.editor.menu_wrapper_css_class;this.IMG_WRAPPER_CLASS_NAME=s.editor.img_wrapper_css_class;this.ANIMATIONS_SPEED=s.editor.animation_speed;this.IMAGE_TYPE_UNKNOWN=0;this.IMAGE_TYPE_EIP=1;this.IMAGE_TYPE_WYSIWYG=2;this.IMAGE_TYPE_PHOTOALBUM=3;this._imageUrl="";this.sEditorId="";this.layout="";this.jqImgNode=null;this.jqMenuWrapper=null;this.jqDeleteButton=null;this.jqCloseButton=null;this.jqImgWrapper=null;this.jqPreloader=null;this.iImageType=this.IMAGE_TYPE_UNKNOWN;this.bEditStateEnabled=false;this.arModulesSet=[];this.arDefaultModules=[q,j,u];this.arActiveModules=[];this.oEnabledModule=null;this.oEventHandlers={}};uAdmin.inherit(o,e);o.prototype.init=function(y,A){var z=this;if(!y){if(this.jqImgNode&&this.jqImgNode.length){y=this.jqImgNode}else{return false}}if(!A&&y&&y.length){A=y.attr(x.getInstance().EDITOR_ID_ATTRIBUTE)}this.sEditorId=A||y.attr(x.getInstance().EDITOR_ID_ATTRIBUTE);if(y.parents("[umi\\:module='photoalbum']").length){this.iImageType=this.IMAGE_TYPE_PHOTOALBUM}else{if(y.is("[umi\\:field-name]")){this.iImageType=this.IMAGE_TYPE_EIP}else{if(y.parents(".mceEditor").length||y.parents("[umi\\:field-type='wysiwyg']")||y.parents(".mce-content-body").length){this.iImageType=this.IMAGE_TYPE_WYSIWYG}}}this.jqImgNode=y;this.jqImgWrapper=jQuery("<div/>").addClass(this.IMG_WRAPPER_CLASS_NAME);this.jqImgWrapper.attr(x.getInstance().EDITOR_ID_ATTRIBUTE,this.sEditorId).on("click",function(B){if(jQuery(B.target).parents("."+z.MENU_WRAPPER_CLASS_NAME).length){return false}z.jqImgNode.trigger("click");return false}).on("contextmenu",function(B){if(!tinymce||!tinymce.activeEditor){return true}B.preventDefault();B.target=z.jqImgNode[0];B.originalEvent.target=z.jqImgNode[0];B.currentTarget=z.jqImgNode[0];B.delegateTarget=z.jqImgNode[0];tinymce.activeEditor.selection.select(z.jqImgNode[0]);tinymce.activeEditor.dom.fire(z.jqImgNode[0],"contextmenu",B);return false}).appendTo("body");this.applyImageSizes();this.drawMenu();this.switchOn();if(this.getEditState()===true){this.setEditMode()}this.jqImgNode.on("mousemove mouseover mouseout mouseenter mouseleave",function(B){B.stopPropagation();B.stopImmediatePropagation();B.preventDefault();return false});this.triggerEvent("onInit")};o.prototype.reinit=function(){var y=x.getInstance().EDITOR_ID_ATTRIBUTE;this.jqImgNode=jQuery("img["+y+"='"+this.sEditorId+"']");this.jqImgWrapper=jQuery("."+this.IMG_WRAPPER_CLASS_NAME).filter("["+y+"='"+this.sEditorId+"']").first();if(!this.jqImgWrapper.length){return}this.jqMenuWrapper=this.jqImgWrapper.find("."+this.MENU_WRAPPER_CLASS_NAME).first();if(!this.jqImgNode.length){return}this.applyImageSizes();this.layout.reposition();this.jqImgWrapper.offset(this.jqImgNode.offset())};o.prototype.initLayout=function(){if(this.layout instanceof m){this.layout.remove()}var z=this.jqImgNode.width(),y=this.jqImgNode.height();if(z>=s.layout.big_img_min_width&&y>=s.layout.big_img_min_height){this.layout=new k(this)}else{if(z<=s.layout.small_img_max_width||y<=s.layout.small_img_max_height){this.layout=new p(this)}else{this.layout=new v(this)}}};o.prototype.drawMenu=function(y){this.jqMenuWrapper=jQuery("<div/>").addClass(this.MENU_WRAPPER_CLASS_NAME);this.initLayout();this.drawModules(y);if(!this.isStub()||this.iImageType===this.IMAGE_TYPE_PHOTOALBUM){this.drawDeleteButton()}this.reposition();this.jqMenuWrapper.appendTo(this.jqImgWrapper)};o.prototype.applyImageBoxSizes=function(z){if(!z||!z.length){z=this.jqImgNode}var y=this,A=function(B){return z.css(B)};this.jqImgWrapper.css({width:A("width"),height:A("height"),paddingTop:A("paddingTop"),paddingRight:A("paddingRight"),paddingBottom:A("paddingBottom"),paddingLeft:A("paddingLeft"),borderTop:A("borderTop"),borderRight:A("borderRight"),borderBottom:A("borderBottom"),borderLeft:A("borderLeft"),marginTop:A("marginTop"),marginRight:A("marginRight"),marginBottom:A("marginBottom"),marginLeft:A("marginLeft")})};o.prototype.applyImageSizes=function(y){if(!y||!y.length){y=this.jqImgNode}this.applyImageBoxSizes(y);this.jqImgWrapper.offset(y.offset())};o.prototype.lockImageSize=function(){this.jqImgNode.css({maxWidth:this.jqImgNode.parent().width(),maxHeight:this.jqImgNode.parent().height()})};o.prototype.redrawMenu=function(y){for(var z in this.arActiveModules){var A=this.arActiveModules[z];if(A instanceof l){A.remove()}}this.jqMenuWrapper.children().remove();this.removeCloseButton();this.drawModules(y);this.initLayout()};o.prototype.drawModules=function(y){if(this.isPopupThumb()){y=[d]}this.resetModules();if(!y){this.setDefaultModules()}else{for(var A in y){this.addModule(y[A])}}var B=this.isStub();this.arActiveModules=[];for(var A in this.arModulesSet){if(!this.arModulesSet.hasOwnProperty(A)){continue}if(B&&this.arModulesSet[A]==q){continue}if(jQuery.browser.msie&&(this.arModulesSet[A]==c||this.arModulesSet[A]==w||this.arModulesSet[A]==j)){continue}var z=new this.arModulesSet[A](this);this.arActiveModules.push(z);this.jqMenuWrapper.append(z.getView(true))}};o.prototype.drawDeleteButton=function(z){if(this.jqDeleteButton&&this.jqDeleteButton.length){this.jqDeleteButton.remove()}var A=a,y=this;if(!this.checkModule(A)){return false}A=new A(this);this.jqDeleteButton=A.getView(true);this.jqDeleteButton.addClass(this.layout.CSS_CLASS_NAME);this.jqImgWrapper.append(this.jqDeleteButton);if(z){this.jqDeleteButton.show()}return true};o.prototype.removeDeleteButton=function(){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.remove()&&(this.jqDeleteButton=null)};o.prototype.addCloseButton=function(y){if(this.jqCloseButton&&this.jqCloseButton.length){return}this.jqCloseButton=jQuery("<span/>").html("&times;");this.jqCloseButton.css({position:"absolute",top:0,right:0,cursor:"pointer",color:"white",fontSize:"15px",lineHeight:"10px",fontWeight:"bold",padding:"3px"}).on("click",function(z){if(typeof y=="function"){y(z)}}).appendTo(this.jqMenuWrapper)};o.prototype.removeCloseButton=function(){this.jqCloseButton&&this.jqCloseButton.length&&this.jqCloseButton.remove()&&(this.jqCloseButton=null)};o.prototype.showPreloader=function(){this.jqPreloader&&this.jqPreloader.length&&this.hidePreloader();this.jqPreloader=jQuery("<div/>").addClass(s.preloader_holder_css_class).append("<img src='"+s.preloader_src+"'>").appendTo(this.jqImgWrapper);this.jqImgWrapper.css("zIndex",parseInt(this.jqImgWrapper.css("zIndex"))*10||999999);this.setEditState(true);this.switchOff()};o.prototype.hidePreloader=function(y){this.jqPreloader&&this.jqPreloader.length&&this.jqPreloader.remove()&&(this.jqPreloader=null);this.jqImgWrapper.css("zIndex",Math.floor(parseInt(this.jqImgWrapper.css("zIndex"))/10)||99999);if(!y){this.setEditMode(false);this.switchOn()}};o.prototype.reposition=function(){this.layout.reposition()};o.prototype.destroy=function(y){this.reinit();this.jqImgWrapper.remove();this.jqImgNode.off("mousemove mouseover mouseout mouseenter mouseleave");if(!y){this.jqImgNode.removeAttr(x.getInstance().EDITOR_ID_ATTRIBUTE)}this.triggerEvent("onDestroy")};o.prototype.show=function(){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.show();this.layout.show()};o.prototype.hide=function(y){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.hide();this.layout.hide(y)};o.prototype.switchOn=function(){var y=this;this.jqImgWrapper.css("zIndex",parseInt(this.jqImgWrapper.css("zIndex"))||99999).on("mouseenter",function(){y.show();if(y.jqDeleteButton&&y.jqDeleteButton.length){y.jqDeleteButton.stop(true,true).show(y.ANIMATIONS_SPEED)}}).on("mouseleave",function(){window.setTimeout(function(){if(y.jqDeleteButton&&y.jqDeleteButton.length){y.jqDeleteButton.stop(true,true).hide(y.ANIMATIONS_SPEED)}y.hide(function(){y.destroy(true)})},100)})};o.prototype.switchOff=function(y){this.jqImgWrapper.off("mouseenter mouseleave");if(y){this.hide();this.jqDeleteButton.hide()}};o.prototype.checkModule=function(A){var z=A==q&&this.checkImageIsEmpty(),C=false;for(var B in s.browser_modules){if(!s.browser_modules.hasOwnProperty(B)||!jQuery.browser[B]){continue}for(var y=0;y<s.browser_modules[B].length;y++){if(s.browser_modules[B][y]===A){C=true;break}}}return typeof A==="function"&&!!A.isImageEditorModule&&!z&&C};o.prototype.addModule=function(y){if(this.checkModule(y)){this.arModulesSet.push(y);this.triggerEvent("onAddModule",[y])}};o.prototype.resetModules=function(){this.arModulesSet=[]};o.prototype.setDefaultModules=function(){this.resetModules();for(var y in this.arDefaultModules){this.addModule(this.arDefaultModules[y])}};o.prototype.isThumb=function(){return(!!this.jqImgNode.attr("src").match(/\/thumbs\//gi)||!!this.jqImgNode.attr("src").match(/\/autothumbs\//gi))};o.prototype.isPopupThumb=function(){if(typeof d=="undefined"){return false}return !!this.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS).length};o.prototype.isStub=function(){var y=this.jqImgNode.attr("umi:is-stub")=="true",z=!(jQuery.browser.msie&&jQuery.browser.version<10)&&this.jqImgNode[0]&&this.jqImgNode[0].complete&&!this.jqImgNode[0].naturalWidth&&!this.jqImgNode[0].naturalHeight;return y||z};o.prototype.getImageUrl=function(){if(!this._imageUrl){if(this.iImageType===this.IMAGE_TYPE_WYSIWYG){this._imageUrl=this.jqImgNode.attr("src")}else{var A=uAdmin.eip.searchAttr(this.jqImgNode);var y=jQuery.ajax({async:false,url:"/udata/content/getImageUrl/"+A.id+"/"+A.field_name+"/.json",type:"GET"});var z=jQuery.parseJSON(y.responseText);this._imageUrl=z.result}}return this._imageUrl};o.prototype.getCurrentImageUrl=function(){return this.isThumb()?this.getImageUrl():this.jqImgNode.attr("src")};o.prototype.getEipInfo=function(y){y=y||this.jqImgNode[0];return uAdmin.eip.searchAttr(y)};o.prototype.getEipNode=function(){var y=this.getEipInfo();if(!y||!y.node){return null}return y.node};o.prototype.getEditorId=function(){return this.sEditorId};o.prototype.checkImageIsEmpty=function(){return this.jqImgNode.attr("src")==this.jqImgNode.attr("umi:empty")};o.prototype.setEnabledModule=function(y){if(!y||!y.deactivate){return false}if(!this.deactivateEnabledModule(y!=q)){return false}this.oEnabledModule=y;x.getInstance().setActiveEditor(this);return true};o.prototype.getEnabledModule=function(){return this.oEnabledModule};o.prototype.deactivateEnabledModule=function(y){if(!this.oEnabledModule||!this.oEnabledModule.deactivate){this.oEnabledModule=null;return true}if(!y){this.oEnabledModule=null;return true}this.oEnabledModule.cancel();if(this.oEnabledModule.deactivate()){this.oEnabledModule=null;return true}return false};o.prototype.cleanupHtml=function(y){return y.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"")};o.prototype.setEditMode=function(y){if(q){var z=new q(this);z.activate(y)}};o.prototype.setEditState=function(y){y?x.getInstance().turnOnEditMode():x.getInstance().turnOffEditMode();this.bEditStateEnabled=!!y};o.prototype.getEditState=function(){return this.bEditStateEnabled};o.prototype.isImageInFocus=function(){var B=this.jqImgNode.offset().top,y=this.jqImgNode.offset().top+this.jqImgNode.height(),A=this.jqImgNode.offset().left,z=this.jqImgNode.offset().left+this.jqImgNode.width();return window.mouseX>A&&window.mouseX<z&&window.mouseY>B&&window.mouseY<y};var f=function(){f.superclass.constructor.call(this)};uAdmin.inherit(f,o);var t=function(){};t.prototype.show=function(){};t.prototype.hide=function(){};t.prototype.reposition=function(){};t.prototype.initLayout=function(){};t.prototype.init=function(){};t.prototype.reinit=function(){};t.prototype.destroy=function(){};t.prototype.switchOn=function(){};t.prototype.switchOff=function(){};t.prototype.setEditMode=function(){};t.prototype.setEditState=function(){};t.prototype.getEditState=function(){};var l=function(){l.superclass.constructor.call(this);this.MODULE_CSS_CLASS=s.module.module_css_class;this.MODULE_ICON_HOLDER_CSS_CLASS=s.module.icon_holder_css_class;this.MODULE_TITLE_HOLDER_CSS_CLASS=s.module.title_holder_css_class;this.BACKEND_REQUEST_URL=s.backend_request_url;this.BACKEND_REQUEST_METHOD=s.backend_request_method;this.title="";this.cssClass="";this.jqElement=null;this.oEditor=null};uAdmin.inherit(l,e);l.prototype.init=function(y){this.oEditor=y;this.jqElement=jQuery("<div/>");this.jqElement.addClass(this.cssClass);this.jqElement.addClass(this.MODULE_CSS_CLASS);this.jqElement.append(jQuery("<span/>"));jQuery("<span/>").addClass(this.MODULE_TITLE_HOLDER_CSS_CLASS).appendTo(this.jqElement);this.setIcon(this.MODULE_ICON_HOLDER_CSS_CLASS);this.setTitle(this.title);this.bindEvents();this.triggerEvent("onInit")};l.prototype.setIcon=function(z){var y=this.jqElement.find("span").first();y.get(0).className="";y.addClass(z)};l.prototype.setTitle=function(y){if(!y){y=this.title}this.title=y;this.jqElement.find("span").first().attr("title",y);this.jqElement.find("span").last().text(y)};l.prototype.bindEvents=function(){var y=this;this.jqElement.on("click",function(z){z.stopPropagation();z.stopImmediatePropagation();z.preventDefault();y.activate();return false})};l.prototype.getView=function(y){if(y===true){return this.jqElement}return this.jqElement[0].outerHTML};l.prototype.activate=function(){var y=this;x.getInstance().deactivateActiveEditor();this.oEditor.setEnabledModule(this);this.triggerEvent("onActivate")};l.prototype.deactivate=function(){this.triggerEvent("onDeactivate");return true};l.prototype.save=function(){this.triggerEvent("onSave")};l.prototype.cancel=function(){this.triggerEvent("onCancel")};l.prototype.remove=function(){this.jqElement.remove();this.triggerEvent("onRemove")};l.prototype.process=function(y,z){if(!y){return{result:false,error:getLabel("js-ieditor-invalid-action")}}this.oEditor.showPreloader();if(!z){z={}}z.image_url=this.oEditor.jqImgNode.attr("src");z.empty_url=this.oEditor.jqImgNode.attr("umi:empty");var C=uAdmin.eip.searchAttr(this.oEditor.jqImgNode[0]);if(C){z.element_id=C.id;z.field_name=C.field_name}var A=jQuery.ajax({async:false,url:this.BACKEND_REQUEST_URL+y+".json",type:this.BACKEND_REQUEST_METHOD,data:z});var B=jQuery.parseJSON(A.responseText);this.processResult(B);return B};l.prototype.processResult=function(y){if(!y){uAdmin.eip.message(getLabel("js-ieditor-request-failed"));this.oEditor.hidePreloader()}else{if(y.error&&y.error.message){uAdmin.eip.message(y.error.message);this.oEditor.hidePreloader()}else{if(y.result&&y.result.length){this.setNewImage(y.result)}else{uAdmin.eip.message(getLabel("js-ieditor-request-failed"));this.oEditor.hidePreloader()}}}};l.prototype.addToEipQueue=function(B,A,y){var z=this.oEditor.getEipInfo(y);if(!z||!z.node){return false}if(this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG){z.old_value=A||z.node.innerHTML;z.new_value=B||z.node.innerHTML.replace(this.oEditor.jqImgNode.attr("src"),B);z.field_type="wysiwyg"}else{z.old_value={src:A||this.oEditor.getCurrentImageUrl()};z.new_value={src:B};z.field_type="img_file"}uAdmin.eip.queue.add(z);return true};l.prototype.getWysiwygContent=function(y){y=y||this.oEditor.getEipNode();if(!y||!y){return null}if(tinymce&&tinymce.activeEditor){return tinymce.activeEditor.getContent()}else{return y.innerHTML}};l.prototype.setNewImage=function(B,A){var y=this,z=(B||"");if(A!==false){this.oEditor.showPreloader();z+="?"+new Date().getTime()}if(this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG){if(d&&d.changeImage){d.changeImage(this.oEditor,z)}if(!B){this.oEditor.jqImgNode.remove();this.oEditor.jqImgWrapper.remove()}else{this.oEditor.jqImgNode.attr("src",z);if(this.oEditor.jqImgNode.attr("data-mce-src")){this.oEditor.jqImgNode.attr("data-mce-src",z)}}}else{this.oEditor.jqImgNode.attr({src:z,"umi:is-stub":false})}this.oEditor.jqImgNode.on("load",function(){y.oEditor.hidePreloader();var C=this;if(y.oEditor.jqImgNode&&y.oEditor.jqImgNode.length){y.oEditor.jqImgNode.removeAttr("width").removeAttr("height");y.oEditor.jqImgNode[0].style.width="";y.oEditor.jqImgNode[0].style.height=""}y.oEditor.reinit();window.setTimeout(function(){uAdmin.eip.normalizeBoxes()},0)});this.oEditor.triggerEvent("onImageChange",{target:this,sNewSrc:B,sNewSrcNoCache:z})};l.prototype.getImageFromFilemanager=function(y){if(typeof y!="function"){return false}jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:s.filemanager.window_width,height:s.filemanager.window_height,url:s.filemanager.url,afterClose:function(z){if(z){y(z)}}});return true};function j(y){j.superclass.constructor.call(this);this.UPLOAD_URL=s.module.upload_module.url;this.IFRAME_NAME=s.module.upload_module.iframe_name;this.FILE_INPUT_NAME=s.module.upload_module.file_input_name;this.title=getLabel("js-ieditor-module-upload-title");this.cssClass=s.module.upload_module.css_class;this.jqFileInput=null;this.jqForm=null;this.jqIframe=null;this.init(y)}uAdmin.inherit(j,l);j.isImageEditorModule=true;j.prototype.init=function(z){var y=this;j.superclass.init.call(this,z);this.jqElement.css({overflow:"hidden",position:"relative"});this.jqFileInput=jQuery("<input/>").attr({type:"file",name:this.FILE_INPUT_NAME,title:this.title}).css({opacity:0,cursor:"pointer"}).on("click",function(A){A.stopPropagation();A.stopImmediatePropagation();y.activate()});this.jqForm=jQuery("<form/>").attr({method:"post",action:this.UPLOAD_URL,target:this.IFRAME_NAME,enctype:"multipart/form-data"}).css({padding:0,margin:0,border:"none",position:"absolute",top:0,right:0}).appendTo(this.jqElement).append(this.jqFileInput)};j.prototype.activate=function(){j.superclass.activate.call(this);this.oEditor.switchOff();var y=this;this.jqIframe=jQuery("<iframe/>").attr({name:this.IFRAME_NAME}).css({display:"none"}).appendTo("body").on("load",function(){if(!y.bImageChanged){return}y.oEditor.hidePreloader();y.oEditor.switchOn();var A=jQuery(this).contents().find("body").text();if(!A){uAdmin.eip.message(getLabel("js-ieditor-request-failed"))}else{var z=y.oEditor.jqImgNode.attr("src");y.setNewImage(A);y.oEditor.setEditMode();y.addToEipQueue(A,z)}y.cleanup()});this.jqFileInput.on("change",function(){y.oEditor.showPreloader();y.bImageChanged=true;y.jqForm.submit()});window.setTimeout(function(){y.oEditor.switchOn();if(jQuery.browser.webkit){y.oEditor.hide()}},1000)};j.prototype.cleanup=function(){this.oEditor.switchOn();this.jqIframe.remove()};function u(y){u.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-filemanager-title");this.cssClass=s.module.filemanager_module.css_class;this.init(y)}uAdmin.inherit(u,l);u.isImageEditorModule=true;u.prototype.activate=function(){u.superclass.activate.call(this);this.oEditor.switchOff();var y=this;this.getImageFromFilemanager(function(A){var z=y.oEditor.jqImgNode.attr("src");y.setNewImage(A[0]);y.oEditor.setEditMode();y.addToEipQueue(A[0],z)});window.setTimeout(function(){y.oEditor.switchOn();if(jQuery.browser.webkit){y.oEditor.hide()}},500)};function q(y){q.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-edit-title");this.cssClass=s.module.edit_module.css_class;this.arEditorModules=[w,b];this.init(y)}uAdmin.inherit(q,l);q.isImageEditorModule=true;q.prototype.activate=function(z){q.superclass.activate.call(this);var y=this;if(this.oEditor.iImageType===this.oEditor.IMAGE_TYPE_WYSIWYG){if(!tinymce.activeEditor){var B=document.body.scrollTop;this.oEditor.reinit();var A=this.oEditor.jqImgNode.attr(x.getInstance().EDITOR_ID_ATTRIBUTE),C=this.oEditor.jqImgNode.attr("src"),D=window.setInterval(function(){if(!tinymce.activeEditor||!tinymce.activeEditor.initialized){return}var F=tinymce.activeEditor.dom.select('img[src="'+C+'"]')[0],E=jQuery(F),G=x.getInstance().initEditor(F);if(G instanceof o==false){return}G.destroy(true);G.setEditState(true);G.init(E,E.attr(x.getInstance().EDITOR_ID_ATTRIBUTE));window.clearInterval(D)},500);this.oEditor.jqImgNode.click();document.body.scrollTop=B;return}this.arEditorModules.push(c);this.arEditorModules.push(d)}this.oEditor.reinit();this.oEditor.hide();this.oEditor.redrawMenu(z||this.arEditorModules);this.oEditor.removeDeleteButton();this.oEditor.addCloseButton(function(E){y.oEditor.switchOn();y.oEditor.setEditState(false);y.oEditor.removeCloseButton();y.oEditor.reinit();y.oEditor.redrawMenu();y.oEditor.drawDeleteButton(true);E.preventDefault();E.stopPropagation();E.stopImmediatePropagation();return false});window.setTimeout(function(){y.oEditor.switchOff();y.oEditor.setEditState(true);y.oEditor.show()},100)};function w(y){w.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-crop-title");this.cssClass=s.module.crop_module.css_class;this.oOriginalImageData={path:"",scale:1,top:0,left:0,width:0,height:0};this.sImgAreaSelectWrapperCssClass=s.img_area_select.css_class;this.jqImgAreaSelectWrapper=null;this.imgAreaSelect=null;this.imgAreaSelectOptions=jQuery.extend({},s.img_area_select.plugin_options);this.imgAreaSelectOptions.parent=this.jqImgAreaSelectWrapper;this.jqOriginalImage=null;this.originalRepositionHandler=null;this.init(y)}uAdmin.inherit(w,l);w.isImageEditorModule=true;w.prototype.init=function(y){w.superclass.init.call(this);this.oEditor=y};w.prototype.activate=function(){w.superclass.activate.call(this);var y=this;if(!jQuery.imgAreaSelect){return}this.originalRepositionHandler=this.oEditor.reposition;this.oEditor.reposition=function(){y.originalRepositionHandler.call(this);this.jqMenuWrapper.css({bottom:-10-this.jqMenuWrapper.height()+"px"})};this.oEditor.hide();this.oEditor.redrawMenu([h,n]);this.oEditor.removeCloseButton();this.oEditor.switchOff();this.oEditor.reposition();this.oEditor.show();this.oEditor.showPreloader();this.initOriginalImageData();this.drawOriginalImage()};w.prototype.save=function(){if(!this.imgAreaSelect){return}w.superclass.deactivate.call(this);var y=this.imgAreaSelect.getSelection();y.scale=this.oOriginalImageData.scale;y.displayWidth=this.oOriginalImageData.displayWidth;y.displayHeight=this.oOriginalImageData.displayHeight;this.oEditor.jqImgNode[0].style.width="";this.oEditor.jqImgNode[0].style.height="";this.oEditor.jqImgNode.removeAttr("width height");this.process("crop",y);this.cleanup()};w.prototype.cancel=function(){w.superclass.deactivate.call(this);this.cleanup()};w.prototype.cleanup=function(){this.oEditor.reposition=this.originalRepositionHandler;this.removeSelection();this.jqImgAreaSelectWrapper.remove();this.oEditor.initLayout();this.oEditor.reinit();this.oEditor.switchOn();this.oEditor.switchOff();var y=this;window.setTimeout(function(){if(y.oEditor.getEnabledModule() instanceof q===false){var z=new q(y.oEditor);z.activate()}},0)};w.prototype.initOriginalImageData=function(){if(this.oOriginalImageData&&this.oOriginalImageData.path&&this.oOriginalImageData.path!=""){return this.oOriginalImageData}var A=this.oEditor.getEipInfo();A.image_url=this.oEditor.jqImgNode.attr("src");delete A.node;var y=jQuery.ajax({async:false,url:s.image_data_url,type:s.image_data_request_method,data:A});var z=jQuery.parseJSON(y.responseText);if(z.path&&z.path!=""){delete z.method;delete z.module;this.oOriginalImageData=z;return this.oOriginalImageData}return false};w.prototype.drawOriginalImage=function(){var y=this;this.jqImgAreaSelectWrapper=jQuery("<div/>").addClass(this.sImgAreaSelectWrapperCssClass).css({display:"none",position:"absolute",top:this.oEditor.jqImgNode.css("paddingTop")||0,left:this.oEditor.jqImgNode.css("paddingLeft")||0,zIndex:100000}).offset(this.oEditor.jqImgNode.offset()).appendTo("body");this.jqOriginalImage=jQuery("<img/>").attr({src:this.oOriginalImageData.path+"?"+new Date().getMilliseconds()}).css({width:this.oOriginalImageData.naturalWidth||"",height:this.oOriginalImageData.naturalHeight||""}).appendTo(this.jqImgAreaSelectWrapper).one("load",function(){y.jqImgAreaSelectWrapper.show();y.repositionOriginalImage();y.setSelection();y.imgAreaSelect.show();y.repositionMenu();y.oEditor.hidePreloader(true)});this.imgAreaSelectOptions.parent=this.jqImgAreaSelectWrapper};w.prototype.repositionOriginalImage=function(){var C=0,z=0,B=0,A=0,y=1;C=this.oOriginalImageData.naturalWidth;B=this.oOriginalImageData.naturalHeight;if(this.oOriginalImageData.width){y=this.oEditor.jqImgNode.width()/this.oOriginalImageData.width}else{y=this.oEditor.jqImgNode.width()/C}this.oOriginalImageData.scale=y;z=C*y;A=B*y;this.jqOriginalImage.css({width:z,maxWidth:z,height:A,maxHeight:A});this.jqImgAreaSelectWrapper.width(z).height(A).offset({left:parseInt(this.oEditor.jqImgNode.css("paddingLeft"))+this.oEditor.jqImgNode.offset().left-(this.oOriginalImageData.left*y||0),top:parseInt(this.oEditor.jqImgNode.css("paddingTop"))+this.oEditor.jqImgNode.offset().top-(this.oOriginalImageData.top*y||0)});this.oOriginalImageData.displayWidth=this.jqOriginalImage.width();this.oOriginalImageData.displayHeight=this.jqOriginalImage.height()};w.prototype.repositionMenu=function(){if(this.jqOriginalImage.outerHeight(true)<=this.oEditor.jqImgNode.outerHeight(true)){return}this.oEditor.applyImageSizes(this.jqOriginalImage);this.oEditor.reposition()};w.prototype.setSelection=function(){this.imgAreaSelect=jQuery(this.jqOriginalImage).imgAreaSelect(this.imgAreaSelectOptions);var z=this.oOriginalImageData.left*this.oOriginalImageData.scale||0,B=this.oOriginalImageData.top*this.oOriginalImageData.scale||0,y=z+(this.oOriginalImageData.width*this.oOriginalImageData.scale||this.oEditor.jqImgNode.width()||0),A=B+(this.oOriginalImageData.height*this.oOriginalImageData.scale||this.oEditor.jqImgNode.height()||0);this.imgAreaSelect.setSelection(z,B,y,A);this.imgAreaSelect.setMode("crop")};w.prototype.removeSelection=function(){this.jqOriginalImage.imgAreaSelect({remove:true});this.imgAreaSelect=null};function c(y){c.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-resize-title");this.cssClass=s.module.resize_module.css_class;this.imgAreaSelect=null;this.imgAreaSelectOptions=jQuery.extend({},s.img_area_select.plugin_options);this.imgAreaSelectOptions.movable=false;this.imgAreaSelectOptions.parent="body";this.oInitialSize={width:0,height:0};this.init(y)}uAdmin.inherit(c,l);c.isImageEditorModule=true;c.prototype.init=function(y){c.superclass.init.call(this);this.oEditor=y;this.imgAreaSelectOptions.aspectRatio=this.oEditor.jqImgNode.width()+":"+this.oEditor.jqImgNode.height()};c.prototype.activate=function(){c.superclass.activate.call(this);var y=this;this.oInitialSize.width=this.oEditor.jqImgNode.width();this.oInitialSize.height=this.oEditor.jqImgNode.height();this.oEditor.hide();this.oEditor.redrawMenu([h,n]);this.oEditor.jqMenuWrapper.css({bottom:-15-this.oEditor.jqMenuWrapper.height()+"px"});this.oEditor.removeCloseButton();this.oEditor.switchOff();this.oEditor.show();this.setSelection()};c.prototype.save=function(){c.superclass.deactivate.call(this);var z={width:this.oEditor.jqImgNode.width(),height:this.oEditor.jqImgNode.height()};this.process("resize",z);this.removeSelection();var y=this;window.setTimeout(function(){y.oEditor.setEditMode()},0)};c.prototype.cancel=function(){this.cleanup();this.oEditor.jqImgNode.width("").height("").removeAttr("width height")};c.prototype.cleanup=function(){this.removeSelection();var y=this;window.setTimeout(function(){y.oEditor.setEditMode()},0)};c.prototype.setSelection=function(){var y=this;this.oEditor.applyImageSizes();tinymce.activeEditor.settings.object_resizing=true;tinymce.activeEditor.selection.controlSelection.showResizeRect(this.oEditor.jqImgNode[0]);tinymce.activeEditor.on("ObjectResized",function(z){y.oEditor.applyImageSizes();y.oEditor.reposition();window.setTimeout(function(){y.setSelection()},0)})};c.prototype.removeSelection=function(){if(tinymce&&tinymce.activeEditor){tinymce.activeEditor.selection.controlSelection.hideResizeRect();tinymce.activeEditor.settings.object_resizing=false}this.oEditor.applyImageSizes()};function b(y){b.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-rotate-title");this.cssClass=s.module.rotate_module.css_class;this.init(y)}uAdmin.inherit(b,l);b.isImageEditorModule=true;b.prototype.activate=function(){this.oEditor.showPreloader();b.superclass.activate.call(this);this.process("rotate")};function d(y){d.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-popup-title");this.cssClass=s.module.popup_module.css_class;this.jqWrapper=null;this.bEnabled=false;this.init(y)}uAdmin.inherit(d,l);d.isImageEditorModule=true;d.FANCYBOX_CSS_CLASS=s.module.popup_module.fancybox_css_class;d.WRAPPER_CSS_CLASS=s.module.popup_module.wrapper_css_class;d.THUMB_WIDTH=s.module.popup_module.thumb_width;d.prototype.init=function(y){d.superclass.init.call(this,y);this.jqWrapper=this.oEditor.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS);if(!this.jqWrapper.length){this.bEnabled=false;this.setTitle(getLabel("js-ieditor-module-popup-title"));this.jqWrapper=jQuery("<a/>").addClass(d.FANCYBOX_CSS_CLASS).addClass(d.WRAPPER_CSS_CLASS).attr("href",this.oEditor.jqImgNode.attr("src"))}else{this.bEnabled=true;this.setTitle(getLabel("js-ieditor-module-popup-title-active"))}};d.prototype.activate=function(){d.superclass.activate.call(this);if(this.bEnabled){this.turnOff()}else{this.turnOn()}this.oEditor.reinit();this.oEditor.initLayout();this.oEditor.setEditState(false);uAdmin.ieditor.disable();uAdmin.ieditor.enable()};d.prototype.turnOn=function(){var B=this.oEditor.getEipNode(),y="",A="";if(B){y=this.oEditor.cleanupHtml(B.innerHTML)}var z=this.oEditor.jqImgNode.width()/this.oEditor.jqImgNode.height();this.oEditor.jqImgNode.width(d.THUMB_WIDTH).height(Math.round(d.THUMB_WIDTH/z)).attr({width:d.THUMB_WIDTH,height:Math.round(d.THUMB_WIDTH/z)}).wrap(this.jqWrapper);if(B){A=this.oEditor.cleanupHtml(B.innerHTML)}if(tinymce&&tinymce.activeEditor){tinymce.activeEditor.on("remove",function(){window.setTimeout(fancybox_init,100)})}uAdmin.eip.bind("Disable",function(C){if(C=="after"){window.setTimeout(fancybox_init,500)}});this.addToEipQueue(A,y);uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-msg"));uAdmin.eip.normalizeBoxes();this.bEnabled=true};d.prototype.turnOff=function(){var A=this.oEditor.getEipNode(),y="",z="";if(A){y=this.oEditor.cleanupHtml(A.innerHTML)}this.jqWrapper=this.oEditor.jqImgNode.parents("."+d.WRAPPER_CSS_CLASS);this.oEditor.jqImgNode.insertAfter(this.jqWrapper);this.jqWrapper.remove();this.oEditor.jqImgNode[0].style.width="";this.oEditor.jqImgNode[0].style.height="";this.oEditor.jqImgNode.removeAttr("data-mce-style width height");if(A){z=this.oEditor.cleanupHtml(A.innerHTML)}this.addToEipQueue(z,y);uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-active-msg"));uAdmin.eip.normalizeBoxes();this.bEnabled=false};d.changeImage=function(A,z){if(A instanceof o===false){return}var y=new d(A);y.init(A);if(y.bEnabled){if(z){y.turnOff();y.turnOn()}else{y.jqWrapper.remove()}}y=null};function a(y){a.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-delete-title");this.cssClass=s.module.delete_module.css_class;this.init(y)}uAdmin.inherit(a,l);a.isImageEditorModule=true;a.prototype.init=function(y){a.superclass.init.call(this,y);this.jqElement.find("."+this.MODULE_ICON_HOLDER_CSS_CLASS).html("&times;")};a.prototype.activate=function(){a.superclass.activate.call(this);var D={};switch(this.oEditor.iImageType){case this.oEditor.IMAGE_TYPE_EIP:var C=this.oEditor.jqImgNode.attr("umi:empty"),A=this.oEditor.jqImgNode.attr("src");this.setNewImage(C,false);this.oEditor.jqImgNode.attr("umi:is-stub",true);this.oEditor.redrawMenu();this.addToEipQueue(C,A);break;case this.oEditor.IMAGE_TYPE_PHOTOALBUM:D=this.oEditor.getEipInfo();D["delete"]=true;uAdmin.eip.queue.add(D);uAdmin.eip.normalizeBoxes();break;case this.oEditor.IMAGE_TYPE_WYSIWYG:var y=this.oEditor.getEipNode(),z=this.getWysiwygContent(y),B="";this.setNewImage("");B=this.getWysiwygContent(y);this.addToEipQueue(B,z,y);break}x.getInstance().removeEmptyEditors();uAdmin.eip.normalizeBoxes();this.triggerEvent("onActivate")};function h(y){n.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-apply-title");this.cssClass=s.module.apply_module.css_class;this.oActiveModule=y.getEnabledModule();this.init(y)}uAdmin.inherit(h,l);h.isImageEditorModule=true;h.prototype.activate=function(){if(this.oActiveModule instanceof l){this.oActiveModule.save();this.oEditor.reinit()}};function n(y){n.superclass.constructor.call(this);this.title=getLabel("js-ieditor-module-cancel-title");this.cssClass=s.module.cancel_module.css_class;this.oActiveModule=y.getEnabledModule();this.init(y)}uAdmin.inherit(n,l);n.isImageEditorModule=true;n.prototype.activate=function(){if(this.oActiveModule instanceof l){this.oActiveModule.cancel()}};return r(g,this)});uAdmin(".wysiwyg",function(extend){function WYSIWYG(){this.settings=jQuery.extend(this[this.type].settings,this.settings);this[this.type]();this.init=this[this.type].init}WYSIWYG.prototype.init=function(){return false};WYSIWYG.prototype.settings=function(){return false};WYSIWYG.prototype.inline=function(){jQuery('<script src="/js/cms/wysiwyg/inline/inlineWYSIWYG.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")};WYSIWYG.prototype.inline.init=function(node){return new inlineWYSIWYG(node)};WYSIWYG.prototype.tinymce=function(){window.tinyMCEPreInit={suffix:"",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"};jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tinymce_custom.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")};WYSIWYG.prototype.tinymce.init=function(node){var editor={},selector="textarea.wysiwyg",settings={};if(uAdmin.eip&&uAdmin.eip.editor){settings.toolbar_standart=this.settings.toolbar_standart.replace(/^imagemanager,/,"");editor={id:"mceEditor-"+new Date().getTime(),destroy:function(){tinyMCE.execCommand("mceToggleEditor",false,editor.id)}};node.id=editor.id;selector="#"+editor.id}settings.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;settings=jQuery.extend(this.settings,settings);settings=jQuery.extend(settings,window.mceCustomSettings);tinyMCE.init(settings);jQuery(selector).each(function(i,n){tinyMCE.execCommand("mceToggleEditor",false,n.id)});return editor};WYSIWYG.prototype.tinymce.settings={mode:"none",theme:"umi",width:"100%",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,imagemanager",inlinepopups_skin:"butterfly",toolbar_standart:"imagemanager,fontsettings,tablesettings,|,cut,copy,paste,|,pastetext,pasteword,|,selectall,cleanup,|,undo,redo,|,link,unlink,anchor,image,media,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:false,theme_umi_resizing:true,convert_urls:false,relative_urls:false,file_browser_callback:function(field_name,url,type,win){if(type=="file"){var sTreeLinkUrl="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html"+(window.lang_id?"?lang_id="+window.lang_id:"");tinyMCE.activeEditor.windowManager.open({url:sTreeLinkUrl,width:525,height:308,inline:true,scrollbars:false,resizable:false,maximizable:false,close_previous:false},{window:win,input:field_name,editor_id:tinyMCE.selectedInstance.editorId});return false}else{var input=win.document.getElementById(field_name),params={},qs=[];if(!input){return false}if(input.value.length){params.folder=input.value.substr(0,input.value.lastIndexOf("/"));params.file=input.value}qs.push("id="+field_name);switch(type){case"image":qs.push("image=1");break;case"media":qs.push("media=1");break}jQuery.ajax({url:"/admin/data/get_filemanager_info/",data:params,dataType:"json",success:function(data){if(data.filemanager=="flash"){if(input.value.length){qs.push("folder=."+params.folder);qs.push("file="+input.value)}}else{qs.push("folder_hash="+data.folder_hash);qs.push("file_hash="+data.file_hash);qs.push("lang="+data.lang)}var fm={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+qs.join("&")},elfinder:{height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+qs.join("&")}};jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:fm[data.filemanager].height,url:fm[data.filemanager].url});if(data.filemanager=="elfinder"){var options='<div id="watermark_wrapper"><label for="add_watermark">';options+=getLabel("js-water-mark");options+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>';options+='<label for="remember_last_folder">';options+=getLabel("js-remember-last-dir");options+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(getCookie("remember_last_folder",true)){options+='checked="checked"'}options+="/></div>";window.parent.jQuery("#popupLayer_Filemanager .popupBody").append(options)}return false}})}return false},extended_valid_elements:"script[type=text/javascript|src|languge|lang],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align]",content_css:"/css/cms/style.css"};WYSIWYG.prototype.tinymce_umiru=function(){window.tinyMCEPreInit={suffix:"_src",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"};jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce_src.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")};WYSIWYG.prototype.tinymce_umiru.init=function(node){var editor,selector="textarea.wysiwyg",settings={};if(uAdmin.eip&&uAdmin.eip.editor){settings.toolbar_standart=this.settings.toolbar_standart.replace(/^imagemanager,/,"");editor={id:"mceEditor-"+new Date().getTime(),destroy:function(){var oldNode=jQuery("#"+editor.id),newNode=jQuery("#"+editor.id+"_parent"),frame=jQuery("iframe",newNode)[0],content;if(jQuery.browser.msie&&(typeof document.documentMode=="undefined"||document.documentMode<7)){content=window.frames[window.frames.length-1].document.body.innerHTML}else{content=frame.contentDocument.body.innerHTML}oldNode.html(content);newNode.remove();oldNode.css("display","");oldNode[0].id=""}};node.id=editor.id;selector="#"+editor.id}settings.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;settings=jQuery.extend(this.settings,settings);tinyMCE.init(settings);jQuery(selector).each(function(i,n){tinyMCE.execCommand("mceAddControl",false,n.id)});return editor};WYSIWYG.prototype.tinymce_umiru.settings={mode:"none",theme:"umiru",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",width:"100%",suffix:"_src",body_class:"text",theme_umi_resizing_use_cookie:false,init_instance_callback:"uAdmin.wysiwyg.initInstance",theme_umi_path:false,constrain_menus:false,extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,umiimage,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",inlinepopups_skin:"butterfly",setup:function(ed){function resize(ed,l){jQuery(ed.getContainer()).children("table.mceLayout").eq(0).css("height","auto");var i=jQuery(ed.getContentAreaContainer()).children("iframe")[0];var h=i.contentWindow.document.body;iHeight=Math.max(jQuery(h).parent().outerHeight(),jQuery(h).outerHeight());i.style.height=iHeight+"px";$("img",ed.getBody()).load(function(){resize(ed,l)})}ed.onChange.add(resize);ed.onKeyDown.add(resize);ed.onLoadContent.add(function(ed,o){if(o.content=="&nbsp;"||o.content==" "){ed.setContent("")}ed.focus();function backTrackTextnode(node){if(node.nodeType==3){return node}var subnodes=$(node).contents();for(var bkt=0;bkt<subnodes.length;bkt++){var result=backTrackTextnode(subnodes[bkt]);if(result){return result}}return false}var nodes_all=ed.dom.select("body");var node=backTrackTextnode(nodes_all[0]);if(!node){if(ed.dom.select("body *").length>0){node=ed.dom.select("body *")[0]}else{node=nodes_all[0]}}else{node=node.parentNode}var rng=ed.selection.getRng();if(!rng||typeof rng.selectNode=="undefined"){return}var tn=ed.getDoc().createTextNode(".");node.insertBefore(tn,node.firstChild);rng.selectNode(tn);rng.setStartBefore(tn);rng.setStartAfter(tn);ed.selection.setRng(rng);node.removeChild(tn);var panel=$("#"+ed.editorContainer+" .toolbarHolder");var panelWidth=1110;var bodyWidth=$("body").width();panel.css("position","fixed");panel.css("top",40);if(bodyWidth>panelWidth){panel.css("left",(bodyWidth-panelWidth)/2)}else{panel.css("left",(bodyWidth-800)/2)}})},toolbar_standart:"umiimage,tablesettings,|,pastetext,pasteword,|,cleanup,|,link,unlink,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:false,theme_umi_resizing:false,convert_urls:false,relative_urls:false,file_browser_callback:"uAdmin.wysiwyg.umiFileBrowserCallback",template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""};WYSIWYG.prototype.tinymce4=function(){window.tinyMCEPreInit={suffix:".min",base:"/js/cms/wysiwyg/tinymce4"};jQuery('<script src="/js/cms/wysiwyg/tinymce4/tinymce.min.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");jQuery('<script src="/js/cms/wysiwyg/tinymce4/plugins/compat3x/plugin.min.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");var jqToolbarHolder=jQuery("<div/>").addClass("toolbarHolder").css({position:"fixed",top:"40px",display:"none"}).appendTo("body");var repositionToolbarHolder=function(editor){if(!editor||editor instanceof tinymce.Editor===false){editor=tinymce&&tinymce.activeEditor}if(!editor){return false}var iDocWidth=jQuery(document).width(),iPanelWidth=Math.min(iDocWidth*0.9,1025),iLeft=(iDocWidth-iPanelWidth)/2;var jqPanel=jQuery(editor.theme.panel.getEl());jqToolbarHolder.width(iPanelWidth).offset({left:iLeft}).draggable().css("cursor","move");jqPanel.find(".mce-toolbar").css("display","inline-block").parent().css("white-space","normal");if(jQuery.draggable){jqPanel.draggable()}};jQuery(document).add(window).on("resize",function(oEvent){if(tinymce&&tinymce.activeEditor){repositionToolbarHolder(tinymce.activeEditor)}});tinymce.on("AddEditor",function(oEvent){oEvent.editor.on("ShowPanel",function(oEvent){repositionToolbarHolder(oEvent.target);window.setTimeout(function(){jQuery(".toolbarHolder").show()},0)})})};WYSIWYG.prototype.tinymce4.init=function(node){var editor,selector="textarea.wysiwyg",settings={};if(uAdmin.eip&&uAdmin.eip.editor){editor={id:"mceEditor-"+new Date().getTime(),destroy:function(){tinymce&&tinymce.activeEditor&&tinymce.activeEditor.destroy()}};node.id=editor.id;selector="#"+editor.id;settings.fixed_toolbar_container=".toolbarHolder";tinymce.on("AddEditor",function(oEvent){oEvent.editor.on("init",function(oEvent){this.fire("focus")})})}settings.language=uAdmin.data["interface-lang"]||uAdmin.data.lang;settings=jQuery.extend(this.settings,settings);settings=jQuery.extend(settings,window.mceCustomSettings);settings.selector=selector;tinymce.init(settings);return editor};WYSIWYG.prototype.tinymce4.settings={inline:true,theme:"modern",skin:"darkgray",language:typeof window.interfaceLang=="string"?interfaceLang:"ru",suffix:".min",schema:"html4",paste_as_text:true,convert_urls:false,toolbar_items_size:"small",extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"umiimage,spellchecker,pagebreak,layer,table,save,hr,image,link,emoticons,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,anchor,charmap,code,textcolor",inlinepopups_skin:"butterfly",toolbar1:"image table | paste pastetext | removeformat | link unlink | charmap code",toolbar2:"formatselect fontselect fontsizeselect",toolbar3:"bold italic underline",toolbar4:"alignleft aligncenter alignright alignjustify",toolbar5:"bullist numlist outdent indent",toolbar6:"forecolor backcolor",toolbar7:"subscript superscript",block_formats:getLabel("js-wysiwyg-paragraph")+"=p;Address=address;Pre=pre;Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Header 6=h6",menubar:false,statusbar:false,resize:false,object_resizing:false,convert_urls:false,relative_urls:false,file_browser_callback:function(){uAdmin.wysiwyg.umiFileBrowserCallback.apply(uAdmin.wysiwyg,arguments)},template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""};WYSIWYG.prototype.initInstance=function(inst){jQuery("div.toolbarHolder").draggable();var el=jQuery(inst.getElement());var iframeBody=jQuery(inst.getDoc()).find("body").eq(0);var attrArray=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","top","right","bottom","left","padding-top","padding-right","padding-bottom","padding-left","overflow-x","overflow-y","white-space","clip","list-style-image","list-style-position","list-style-type","marker-offset"];for(var i in attrArray){iframeBody.css(attrArray[i],el.css(attrArray[i]))}function getInternetExplorerVersion(){var rv=-1;if(navigator.appName=="Microsoft Internet Explorer"){var ua=navigator.userAgent;var re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(re.exec(ua)!=null){rv=parseFloat(RegExp.$1)}}return rv}var ieVersion=getInternetExplorerVersion();if(ieVersion>-1&&ieVersion<=8){iframeBody.css("background-color","")}iframeBody.css("height","auto");var containerAttrArray=["margin-top","margin-right","margin-bottom","margin-left"];jQuery("#"+inst.editorContainer).css("display","block");for(var j in containerAttrArray){jQuery("#"+inst.editorContainer).css(containerAttrArray[j],el.css(containerAttrArray[j]))}inst.formatter.register({fontsize:{inline:"span",styles:{fontSize:"%value","line-height":"1.3em"}}});var cookie=tinymce.util.Cookie;cookie.set("tinymcePasteText","1",new Date(new Date().getFullYear()+1,12,31))};WYSIWYG.prototype.umiFileBrowserCallback=function(field_name,url,type,win){switch(type){case"file":uAdmin.wysiwyg.umiTreeLink(field_name,url,type,win);break;case"image":case"media":var input=win.document.getElementById(field_name);if(!input){return false}var folder="";var file="";if(input.value.length){folder=input.value.substr(0,input.value.lastIndexOf("/"));file=input.value}jQuery.ajax({url:"/admin/data/get_filemanager_info/",data:"folder="+folder+"&file="+file,dataType:"json",complete:function(data){data=jQuery.parseJSON(data.responseText);var folder_hash=data.folder_hash;var file_hash=data.file_hash;var lang=data.lang;var fm=data.filemanager;var functionName="uAdmin.wysiwyg.umi"+fm+"FileManager";eval(functionName+"(field_name, url, type, win, lang, folder_hash, file_hash)")}});break}return false};WYSIWYG.prototype.umielfinderFileManager=function(field_name,url,type,win,lang,folder_hash,file_hash){var qs=[];qs.push("id="+field_name);switch(type){case"image":qs.push("image=1");break;case"media":qs.push("media=1");break}qs.push("folder_hash="+folder_hash);qs.push("file_hash="+file_hash);qs.push("lang="+lang);$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+qs.join("&")});if(tinymce&&tinymce.activeEditor&&tinymce.activeEditor.settings.inline){jQuery("#popupLayer_Filemanager .popupBody").append('<div id="watermark_wrapper"><label for="add_watermark">'+getLabel("js-water-mark")+'</label><input type="checkbox" name="add_watermark" id="add_watermark"></div>')}else{window.parent.jQuery("#popupLayer_Filemanager .popupBody").append('<div id="watermark_wrapper"><label for="add_watermark">'+getLabel("js-water-mark")+'</label><input type="checkbox" name="add_watermark" id="add_watermark"></div>')}return false};WYSIWYG.prototype.umiflashFileManager=function(field_name,url,type,win,lang,folder_hash,file_hash){var input=win.document.getElementById(field_name);if(!input){return false}var qs=[];qs.push("id="+field_name);switch(type){case"image":qs.push("image=1");break;case"media":qs.push("media=1");break}if(input.value.length){var folder=input.value.substr(0,input.value.lastIndexOf("/"));qs.push("folder=."+folder);qs.push("file="+input.value)}$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+qs.join("&")});return false};WYSIWYG.prototype.umiTreeLink=function(field_name,url,type,win){var domain_floated=window.pageData?window.pageData.domain:"";var domain_floated_id=window.pageData?window.pageData.domain_id:"";var lang_id=window.pageData.lang_id;var sTreeLinkUrl="";var iPageHight=0;if(tinyMCE.majorVersion<4){sTreeLinkUrl="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html?domain="+domain_floated+"&domain_id="+domain_floated_id+"&lang_id="+lang_id;iPageHight=308}else{sTreeLinkUrl="/js/cms/wysiwyg/tinymce4/skins/lightgray/treelink.html?domain="+domain_floated+"&domain_id="+domain_floated_id+"&lang_id="+lang_id;iPageHight=320}tinyMCE.activeEditor.windowManager.open({url:sTreeLinkUrl,title:getLabel("js-choose-page"),width:525,height:iPageHight,inline:true,scrollbars:false,resizable:false,maximizable:false,close_previous:false},{window:win,input:field_name,editor_id:tinyMCE.activeEditor.id});return false};WYSIWYG.prototype.getFilemanagerFooter=function(filemanager){var footer="";if(filemanager=="elfinder"){footer='<div id="watermark_wrapper" class="ui-widget-header">';footer+='<label for="remember_last_folder">';footer+=getLabel("js-remember-last-dir");footer+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"';if(jQuery&&jQuery.cookie&&jQuery.cookie("remember_last_folder")){footer+='checked="checked"'}footer+="/></div>"}return footer};return extend(WYSIWYG,this)});uAdmin.onLoad("wysiwyg",function(){uAdmin.wysiwyg.curr_mouse_position={top:0,left:0};$("body").click(function(a){uAdmin.wysiwyg.curr_mouse_position={top:a.pageY-window.pageYOffset,left:a.pageX-window.pageXOffset}})});uAdmin(".session",function(b){function a(){var c=this;c.access=!!c.access;c.lifetime=parseInt(c.lifetime)||10;c.pingInterval=Math.min((c.lifetime*60)/2,300);c.awayTimeout=0;c.lastPingedTime=new Date();c.currentMessage=null;this.lastActionTime=new Date();(function d(){jQuery(document).bind("click keydown mousedown",null,function(e){c.eventHandler(e)});setTimeout(function(){jQuery("iframe").each(function(){try{var g=this.contentWindow||this.contentDocument;if(g.document){jQuery(g.document).bind("click keydown mousedown",function(e){c.eventHandler(e)})}}catch(f){}})},5000);c.pingIntervalHandler=setInterval(function(){c.pingHandler()},c.pingInterval*1000)})()}a.prototype.sessionAjax=function(c,d){jQuery.get("/session.php",c,function(e){if(typeof d=="function"){d(e)}})};a.prototype.login=function(c,d,e){this.sessionAjax({"u-login":c,"u-password":d,a:"ping"},function(f){if(typeof e=="function"){e(f!="-1")}})};a.prototype.check=function(){var c=this;this.sessionAjax(null,function(d){c.checkHandler(d)})};a.prototype.ping=function(d){var c=this;if(((new Date()).getTime()-c.lastPingedTime.getTime()<5000)&&!d){return}c.lastPingedTime=new Date();c.sessionAjax({a:"ping"},function(e){c.checkHandler(e)})};a.prototype.checkHandler=function(d){switch(d){case"-1":case"0":this.showCloseMessage(true);break;default:this.awayTimeout=parseInt(d,10);if(this.awayTimeout<=this.pingInterval+10){this.showWarningMessage()}else{if(!this.pingIntervalHandler){var c=this;this.pingIntervalHandler=setInterval(function(){c.pingHandler()},this.pingInterval*1000)}this.closeMessage()}break}};a.prototype.isUserActive=function(){return(new Date().getTime()-this.lastActionTime.getTime())/1000<this.pingInterval};a.prototype.eventHandler=function(c){this.lastActionTime=new Date();switch(this.currentMessage){case"warning":this.closeMessage();this.ping(true);case"close":this.ping()}};a.prototype.pingHandler=function(){if(this.isUserActive()){this.ping()}else{this.check()}};a.prototype.showWarningMessage=function(d){var c=this;if(d){clearInterval(c.timer);c.timer=null}c.currentMessage="warning";if(c.timer){return}c.timer=setInterval(function(){if(c.awayTimeout>0){var j=c.awayTimeout;var f=parseInt(j/60);var g=j%60;if(g<10){g="0"+g}var h=f+":"+g;var e=parseInt((c.lifetime*60-c.awayTimeout)/60);c.message(getLabel("js-session-is-away")+" "+e+" "+getLabel("js-minutes")+". "+getLabel("js-session-warning")+"<br/>"+h);c.awayTimeout--}else{c.closeMessage();c.check()}},1000)};a.prototype.showCloseMessage=function(e){var c=this;if(e){clearInterval(c.timer);c.timer=null}if(c.currentMessage=="close"){return}c.currentMessage="close";if(c.pingIntervalHandler){clearInterval(c.pingIntervalHandler);c.pingIntervalHandler=0}var f=jQuery("<div><br />"+getLabel("js-session-was-away")+" "+c.lifetime+" "+getLabel("js-minutes")+", "+getLabel("js-session-close")+"<br/><br/></div>");var d=jQuery('\n			<form>\n				<table cellspacing="5" width="100%">\n					<tr>\n						<td>'+getLabel("js-label-login")+': </td>\n						<td><input type="text" name="session_contorl_login" /></td>\n					</tr>\n					<tr>\n						<td>'+getLabel("js-label-password")+':</td>\n						<td><input type="password" name="session_contorl_passsword" /></td>\n					</tr>\n				</table>\n				<br/>\n				<input type="submit" value="'+getLabel("js-label-login-do")+'">\n			</form>\n		').appendTo(f);if(c.access){jQuery("<br/> <br/><a href='/admin/config/main/' target='_blank'>"+getLabel("js-session-lifetime-configure")+"</a>").appendTo(d)}d.submit(function(){var h=jQuery.trim(this.session_contorl_login.value),g=jQuery.trim(this.session_contorl_passsword.value);if(h&&g){c.login(h,g,function(j){if(j){jQuery.getJSON("/admin/config/main/.json",{},function(k){if(uAdmin.csrf&&uAdmin.csrf!=k.csrf){uAdmin.csrf=k.csrf}else{if(csrfProtection&&csrfProtection.getToken()!=k.csrf){csrfProtection.changeToken(k.csrf)}}});c.closeMessage();c.pingIntervalHandler=setInterval(function(){c.pingHandler()},c.pingInterval*1000);jQuery.jGrowl(getLabel("js-session-restored"),{header:"UMI.CMS",life:5000})}else{jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5000})}})}else{jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5000})}return false});c.message(f)};a.prototype.message=function(e){var c=this;if(typeof e=="string"){e="<br/><p> "+e+" </p>"}if(!c.jgrowl){c.jgrowl=-1;jQuery.jGrowl(e,{header:"UMI.CMS",dont_close:true,beforeOpen:function(f){c.jgrowl=jQuery(f)},close:function(){c.closeMessage();c.ping(true)}});return}else{if(c.jgrowl!=-1){var d=c.jgrowl.find(".jGrowl-message");if(typeof e=="string"){d.html(e)}else{d.html("");d.append(e)}}}};a.prototype.closeMessage=function(){this.currentMessage=null;if(this.timer){clearInterval(this.timer);this.timer=null}if(this.jgrowl&&this.jgrowl!=-1){this.jgrowl.mouseout();this.jgrowl.remove();this.jgrowl=null}};a.prototype.destroy=function(){if(this.pingIntervalHandler){clearInterval(this.pingIntervalHandler);this.pingIntervalHandler=0}if(this.timer){clearInterval(this.timer);this.timer=null}return true};return b(a,this)});function RGBColor(g){this.ok=false;if(g.charAt(0)=="#"){g=g.substr(1,6)}g=g.replace(/ /g,"");g=g.toLowerCase();var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in a){if(g==c){g=a[c]}}var h=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(j){return[parseInt(j[1]),parseInt(j[2]),parseInt(j[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(j){return[parseInt(j[1],16),parseInt(j[2],16),parseInt(j[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(j){return[parseInt(j[1]+j[1],16),parseInt(j[2]+j[2],16),parseInt(j[3]+j[3],16)]}}];for(var b=0;b<h.length;b++){var e=h[b].re;var d=h[b].process;var f=e.exec(g);if(f){channels=d(f);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHash=function(){return{red:this.r,green:this.g,blue:this.b}};this.inverse=function(){this.r=255-this.r;this.g=255-this.g;this.b=255-this.b};this.toHex=function(){var l=this.r.toString(16);var k=this.g.toString(16);var j=this.b.toString(16);if(l.length==1){l="0"+l}if(k.length==1){k="0"+k}if(j.length==1){j="0"+j}return"#"+l+k+j}}function relationControl(r,b,j,h){var e=this;var d=r;var v=b||r;var q=true;var y=null;var B=null;var s=null;var f=null;var C=null;var a=null;var c=null;var A=null;var t=null;var m=0;var l=0;var z=h||"/admin/data/guide_items_all/";var w=function(){y=document.getElementById("relationSelect"+v);B=document.getElementById("relationInput"+v);s=document.getElementById("relationButton"+v);if(!y){alert("Select input for field #"+v+" not found");return}jQuery("option",y).each(function(){if(!this.selected&&this.value.length!==0){q=false}});if(s){s.onclick=function(){e.addItem()}}if(B){B.onkeyup=function(G){var F=G?G.keyCode:event.keyCode;if(F==13&&s){e.addItem();return false}else{e.doSearch()}};B.onkeydown=function(G){var F=G?G.keyCode:event.keyCode;if(F==13){return false}}}var E=function(){if(q){e.loadItemsAll();q=false}};y.onmouseover=E;y.onfocus=E;for(var D=0;D<y.childNodes.length;D++){if(y.childNodes[D].nodeType!=1){y.removeChild(y.childNodes[D]);D=0}}if(j&&jQuery("option[value='']",y).size()==0){jQuery(y).prepend("<option value=''></option>")}};this.rescan=function(){B=document.getElementById("relationInput"+v);if(B){B.onkeyup=function(E){var D=E?E.keyCode:event.keyCode;if(D==13&&s){e.addItem()}else{e.doSearch()}}}};this.getValue=function(){var F=jQuery("option:selected",jQuery(y));var D={};for(var E=0;E<F.length;E++){D[F[E].value]=jQuery(F[E]).text()}return D};this.loadItems=function(D){jQuery.ajax({url:z+d+".xml?limit&search[]="+encodeURIComponent(D),type:"get",complete:function(F,E){e.updateItems(F)}})};this.loadItemsAll=function(){jQuery.ajax({url:z+d+".xml?allow-empty",type:"get",complete:function(E,D){e.updateItemsAll(E)}})};this.updateItemsAll=function(E){if(E.responseXML.getElementsByTagName("empty").length){if(B){B.onkeyup=function(P){var O=P?P.keyCode:event.keyCode;switch(O){case 38:if(A.length&&(t>0||t==null)){g((t===null)?(A.length-1):(t-1))}break;case 40:if(A.length&&(t<(A.length-1)||t==null)){g((t===null)?0:(t+1))}break;case 13:k();n();break;case 27:n();break;default:clearTimeout(c);c=setTimeout(function(){e.doSearchAjax()},500)}};B.onblur=function(){if(a){if(m<parseInt(a.style.left)||m>(parseInt(a.style.left)+parseInt(a.offsetWidth))||l<parseInt(a.style.top)||l>(parseInt(a.style.top)+parseInt(a.offsetHeight))){n()}}};var K=E.responseXML.getElementsByTagName("empty")[0].getAttribute("total");if(!C){C=new Option(" ","");C.innerHTML=getLabel("js-relation-total")+K+". "+getLabel("js-relation-use_search");y.insertBefore(C,y.firstChild)}}return}var I=E.responseXML.getElementsByTagName("object");var L=[];var F=0;for(F=0;F<y.options.length;F++){if(y.options[F].selected){L.push(y.options[F].value)}}jQuery("option",y).each(function(){if(!this.selected||this.value.length===0){jQuery(this).remove()}});if(j){$(y).prepend("<option value=''> </option>")}for(F=0;F<I.length;F++){var J=I[F].getAttribute("id");var G=false;for(var M in L){if(L[M]==J){G=true;delete L[M];break}}if(!G){var N=I[F].getAttribute("name");var D=new Option(N,J);D.innerHTML=N;y.appendChild(D)}}if(jQuery.browser.msie){var H=y.style.display;y.style.display="none";y.style.display=H}};this.updateItems=function(E){t=null;A=E.responseXML.getElementsByTagName("object");if(!A.length){return}var F=null;if(!a){a=document.createElement("div");a.className="relationAutosuggest";var H=jQuery(B).offset();a.style.position="absolute";a.style.zIndex=1050;a.style.width=B.clientWidth+"px";a.style.top=(H.top+B.offsetHeight)+"px";a.style.left=H.left+"px";F=document.createElement("ul");a.appendChild(F);document.body.appendChild(a)}a.style.display="";jQuery(document).mousemove(o);F=a.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}for(i=0;i<A.length;i++){var G=A[i].getAttribute("name");var D=document.createElement("li");D.innerHTML=G;D.onmouseover=function(){g(this.suggestIndex)};D.onmouseout=function(){this.className=""};D.onclick=function(){k();n()};D.suggestIndex=i;F.appendChild(D)}};var o=function(D){if(!D){m=event.clientX+document.body.scrollLeft;l=event.clientY+document.body.scrollTop}else{m=D.pageX;l=D.pageY}return true};this.addItem=function(E,D){if(!(E&&E.length)&&!(B&&B.value.length)){return}x();u();if(!y.multiple&&f&&!E&&!D){f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+B.value;f.value=D?D:B.value;y.selectedIndex=0}else{f=new Option(E?E:B.value,D?D:B.value);f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+(E?E:B.value);if(y.options.length){y.insertBefore(f,y.firstChild)}else{y.appendChild(f)}}B.value="";f.selected=true;if(jQuery.browser.msie){setTimeout(function(){f.selected=false;f.selected=true},20)}};var g=function(E){if(a.style.display!="none"){var F=a.firstChild;var D=F.childNodes.item(t);if(D){D.className=""}F.childNodes.item(E).className="active";t=E}};var k=function(){if(a&&a.style.display!="none"&&t!==null){var G=A[t].getAttribute("name");var F=A[t].getAttribute("id");var E=false;for(var D=0;D<y.options.length;D++){if(y.options[D].value==F){E=true;y.options[D].selected=true;break}}if(!E){e.addItem(G,F)}}else{if(B.value.length&&s){e.addItem()}}};var n=function(){if(a&&a.style.display!="none"){a.style.display="none";jQuery(document).unbind("mousemove",o)}};this.doSearch=function(){var G=B.value.toLowerCase();x();if(G==""){if(y.multiple){u()}return}for(var E=0;E<y.options.length;E++){var H=y.options[E].text;var F=H.replace(/^.\s\s/,"");if(H.substring(0,G.length).toLowerCase()===G||F.substring(0,G.length).toLowerCase()===G){if(y.multiple){if(y.firstChild.nodeName.toLowerCase()!="optgroup"){p();searchGroup=y.firstChild;itemsGroup=y.lastChild}var D=y.options[E];if(D.parentNode==searchGroup){continue}D.oldPrevSibling=D.previousSibling;itemsGroup.removeChild(D);searchGroup.appendChild(D);if(searchGroup.childNodes.length==5){return}}else{y.selectedIndex=E;return}}}};this.doSearchAjax=function(){if(B.value){this.loadItems(B.value)}};var p=function(){var E=document.createElement("optgroup");E.label="Search results";var D=document.createElement("optgroup");D.label="------------------------------------------------";while(y.firstChild){var F=y.firstChild;y.removeChild(F);D.appendChild(F)}y.appendChild(E);y.appendChild(D)};var u=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){y.removeChild(y.firstChild);var D=y.firstChild;while(D.firstChild){var E=D.firstChild;D.removeChild(E);y.appendChild(E)}y.removeChild(D)}};var x=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){var E=y.firstChild;var D=y.lastChild;while(E.firstChild){var F=E.firstChild;E.removeChild(F);if(F.oldPrevSibling!==undefined||F.oldPrevSibling==null){if(F.oldPrevSibling&&F.oldPrevSibling.nextSibling){D.insertBefore(F,F.oldPrevSibling.nextSibling)}else{if(F.oldPrevSibling===null){D.insertBefore(F,D.firstChild)}else{D.appendChild(F)}}F.oldPrevSibling=undefined}}}};w()}function symlinkControl(y,k,E,H,G,f){G=(G instanceof Array)?G:[G];var e=this;var x=y;var D=(E instanceof Array)?E:[E];var b=(D)?"&hierarchy_types="+D.join("-"):"";var l=(G instanceof Array)?"&hierarchy_types="+G.join(","):"";var a=k||null;var u=null;var j=null;var w=null;var r=null;var J=null;var s=null;var C=null;var A=0;var z=0;if(!H){H={}}var I=H.iconsPath||"/images/cms/admin/mac/tree/";var B=H.fadeColorStart||[255,0,0];var o=H.fadeColorEnd||[255,255,255];var m=H.inputName||("symlinkInput"+x);var p=H.noImages||false;var h={};var q=(f?"&callback=symlinkControlsList."+x+".onlyOne":"");var F=function(){if(!window.symlinkControlsList){window.symlinkControlsList={}}window.symlinkControlsList[x]=e;u=document.getElementById("symlinkInput"+x);if(!u){alert("Symlink container #"+x+" not found");return}var L=document.createElement("input");L.type="hidden";L.name=m;u.parentNode.insertBefore(L,u);r=document.createElement("ul");u.appendChild(r);j=document.createElement("input");u.appendChild(j);w=p?document.createElement("input"):document.createElement("img");u.appendChild(w);j.type="text";if(p){w.type="button";w.value="╘"}else{w.src="/images/cms/admin/mac/tree.png";w.height="18"}w.className="treeButton";w.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:"Выбор страницы",width:620,height:335,url:"/styles/common/js/tree.html?id="+x+(a?"&module="+a:"")+l+(window.lang_id?"&lang_id="+window.lang_id:"")+q})};r.className="pageslist";j.onkeypress=function(N){var M=N?N.keyCode:window.event.keyCode;if(M==13){return false}};j.onkeyup=function(N){var M=N?N.keyCode:window.event.keyCode;switch(M){case 38:if(s.length&&(C>0||C==null)){n((C===null)?(s.length-1):(C-1))}break;case 40:if(s.length&&(C<(s.length-1)||C==null)){n((C===null)?0:(C+1))}break;case 13:t();K();return false;break;case 27:K();break;default:e.doSearch()}};j.onblur=function(){if(J){if(A<parseInt(J.style.left)||A>(parseInt(J.style.left)+parseInt(J.offsetWidth))||z<parseInt(J.style.top)||z>(parseInt(J.style.top)+parseInt(J.offsetHeight))){K()}}}};this.loadItems=function(L){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+b+(window.lang_id?"&lang_id="+window.lang_id:"")+"&search-all-text[]="+encodeURIComponent(L),type:"get",complete:function(N,M){e.updateItems(N)}})};this.onlyOne=function(M,N,L,O){jQuery.closePopupLayer("Sitetree");if(confirm(getLabel("js-island-change-symlink-warning"))){jQuery("a.button",r).click();e.addItem(M,N,O,L);jQuery('form input[name="save-mode"]:first').click()}};this.updateItems=function(M){var N=(jQuery("html.u-eip").size()>0);C=null;s=M.responseXML.getElementsByTagName("page");if(!s.length){return}var O=[];for(var P=0;P<s.length;P++){if(h[s[P].getAttribute("id")]){continue}O[O.length]=s[P]}s=O;var Q=null;if(!J){J=document.createElement("div");J.className="symlinkAutosuggest";var T=jQuery(j).offset();J.style.position="absolute";J.style.zIndex=1050;J.style.width=j.clientWidth+"px";J.style.top=(T.top+j.offsetHeight)+"px";J.style.left=T.left+"px";if(N){J.style.backgroundColor="white";J.style.border="1px solid #ccc"}Q=document.createElement("ul");J.appendChild(Q);document.body.appendChild(J)}v();jQuery(document).mousemove(d);Q=J.firstChild;while(Q.firstChild){Q.removeChild(Q.firstChild)}for(P=0;P<s.length;P++){if(h[s[P].getAttribute("id")]){continue}var L=g(s[P].getElementsByTagName("name")[0]);var R=g(s[P].getElementsByTagName("basetype")[0]);var S=s[P].getAttribute("link");var W=document.createElement("li");var V=document.createElement("span");var U=document.createElement("a");W.title=L;if(L.length>20){L=L.substr(0,20)+"..."}if(S.length>55){S=S.substr(0,55)+"..."}W.appendChild(document.createTextNode(L));W.appendChild(V);V.appendChild(document.createTextNode(" ("+R+")"));if(!N){W.appendChild(document.createElement("br"));W.appendChild(U);U.appendChild(document.createTextNode(S));U.href=S;U.target="_blank"}else{V.style.display="block";W.className="symlink-item-delete";W.style.padding="3px"}W.onmouseover=function(){n(this.suggestIndex)};W.onclick=function(){t();K()};W.suggestIndex=P;Q.appendChild(W)}};this.doSearch=function(){var L=j.value;e.loadItems(L)};var n=function(N){var M=(jQuery("html.u-eip").size()>0);if(J.style.display!="none"){var O=J.firstChild;var L=O.childNodes.item(C);if(L){if(M){L.style.backgroundColor=""}else{L.className=""}}if(M){O.childNodes.item(N).style.backgroundColor="#ceeaf6"}else{O.childNodes.item(N).className="active"}C=N}};var t=function(){if(J&&J.style.display!="none"&&C!==null){var R=s[C].getAttribute("id");var M=g(s[C].getElementsByTagName("name")[0]);var L=s[C].getAttribute("link");var P=s[C].getElementsByTagName("basetype")[0];var O="";var N=(O=P.getAttribute("module"))?O:"";var Q=(O=P.getAttribute("method"))?O:"";e.addItem(R,M,[N,Q],L)}};this.addItem=function(P,M,Q,N){if(h[P]!==undefined){return}var R=(jQuery("html.u-eip").size()>0);var S=document.createElement("li");var W=document.createElement("span");var U=document.createElement("a");var O=document.createElement("a");var V=document.createElement("input");V.type="hidden";V.name=m;V.value=P;O.input=V;U.href=N;if(p){O.appendChild(document.createTextNode("[x]"))}else{var L=document.createElement("img");L.src=I+"symlink_delete.png";L.alt="delete";if(R){L.className="symlink-item-delete"}O.appendChild(L)}O.href="javascript:void(0);";if(R){O.style.marginRight="5px"}else{O.className="button"}O.onclick=function(){this.input.parentNode.removeChild(this.input);r.removeChild(this.parentNode);delete h[P]};W.title=Q[0]+" "+Q[1];if(R){W.style.marginLeft="5px";W.style.position="relative";W.style.top="-3px"}W.appendChild(document.createTextNode(M));U.appendChild(document.createTextNode(N));S.appendChild(O);if(!p){var T=document.createElement("img");T.src=I+"ico_"+Q[0]+"_"+Q[1]+".png";S.appendChild(T)}S.appendChild(W);if(R){delete U}else{S.appendChild(U)}r.appendChild(S);u.parentNode.insertBefore(V,u);S.style.backgroundColor=makeHexRgb(B);S.startColor=B;S.endColor=o;S.pname=M;S.fade=c;setTimeout(function(){S.fade()},2000);h[P]=true;if(jQuery("#eip_page").size()){frameElement.height=(jQuery("#eip_page").height()>500)?500:jQuery("#eip_page").height()}};var c=function(){if(this.fadeColor==undefined){this.fadeColor=[];this.fadeColor[0]=this.startColor[0];this.fadeColor[1]=this.startColor[1];this.fadeColor[2]=this.startColor[2]}if(Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])==Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){return}this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50;this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50;this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50;this.style.backgroundColor=makeHexRgb(this.fadeColor);var L=this;setTimeout(function(){L.fade()},20)};var v=function(){if(J){var L=jQuery(j).offset();J.style.width=j.clientWidth;J.style.top=L.top+j.offsetHeight;J.style.left=L.left;J.style.display=""}};var K=function(){if(J&&J.style.display!="none"){J.style.display="none";jQuery(document).unbind("mousemove",d)}};var d=function(L){if(!L){A=event.clientX+document.body.scrollLeft;z=event.clientY+document.body.scrollTop}else{A=L.pageX;z=L.pageY}return true};var g=function(L){return(L.firstChild&&L.firstChild.nodeType==3)?L.firstChild.nodeValue:L.nodeValue};F()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(b){var a="";for(var c=0;c<3;c++){a=a+hex[Math.floor(b[c]/16)]+hex[Math.floor(b[c]%16)]}return"#"+a};